<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Map</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', 'Arial', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            overflow: hidden;
            position: relative;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            color-scheme: dark;
        }

        /* Enhanced Universe Background */
        #universe {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: linear-gradient(125deg, rgba(26,32,44,0.8) 0%, rgba(8,9,22,0.9) 100%);
            overflow: hidden; /* Prevent any potential overflow issues */
        }

        /* Nebula Effect */
        .nebula {
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.15;
            z-index: 0;
            animation: nebulaPulse 15s infinite alternate;
            transform-origin: center center;
            will-change: transform, opacity;
        }

        @keyframes nebulaPulse {
            0% { opacity: 0.1; transform: scale(1) rotate(0deg); }
            50% { opacity: 0.2; transform: scale(1.05) rotate(1deg); }
            100% { opacity: 0.1; transform: scale(1) rotate(0deg); }
        }

        /* Ultra-Realistic Comet */
        .comet {
            position: absolute;
            z-index: 5;
            pointer-events: none;
            opacity: 0;
            animation: cometFly 30s linear infinite;
            transform-style: preserve-3d;
            will-change: transform, opacity;
        }

        .comet-head {
            position: absolute;
            width: 12px;
            height: 12px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50%;
            box-shadow: 
                0 0 15px 4px rgba(255, 255, 255, 0.8),
                0 0 30px 8px rgba(173, 216, 230, 0.6),
                0 0 50px 15px rgba(135, 206, 235, 0.4);
            transform: translateZ(0);
        }

        .comet-tail {
            position: absolute;
            top: 6px;
            left: 6px;
            width: 200px;
            height: 4px;
            background: linear-gradient(to left, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0));
            transform-origin: left center;
            transform: rotate(180deg) translateZ(0);
            border-radius: 50%;
            filter: blur(1px);
            box-shadow: 
                0 0 8px 2px rgba(255, 255, 255, 0.4),
                0 0 15px 4px rgba(173, 216, 230, 0.3);
        }

        .comet-dust {
            position: absolute;
            top: 6px;
            left: 6px;
            width: 150px;
            height: 20px;
            background: linear-gradient(to left, rgba(173, 216, 230, 0.4), rgba(173, 216, 230, 0));
            transform-origin: left center;
            transform: rotate(180deg) translateZ(0);
            filter: blur(4px);
            opacity: 0.6;
        }

        @keyframes cometFly {
            0% {
                top: -50px;
                left: 110%;
                transform: rotate(-30deg) scale(0.8);
                opacity: 0;
            }
            5% {
                opacity: 1;
                transform: rotate(-30deg) scale(1);
            }
            95% {
                opacity: 1;
                transform: rotate(-30deg) scale(1);
            }
            100% {
                top: 120%;
                left: -10%;
                transform: rotate(-30deg) scale(0.8);
                opacity: 0;
            }
        }

        /* Second Comet */
        .comet2 {
            position: absolute;
            z-index: 5;
            pointer-events: none;
            opacity: 0;
            animation: cometFly2 45s linear infinite;
            animation-delay: 15s;
            transform-style: preserve-3d;
            will-change: transform, opacity;
        }

        .comet2 .comet-head {
            width: 8px;
            height: 8px;
            background: rgba(255, 240, 220, 0.95);
            box-shadow: 
                0 0 12px 3px rgba(255, 240, 220, 0.8),
                0 0 25px 7px rgba(255, 223, 186, 0.6),
                0 0 40px 12px rgba(255, 200, 150, 0.4);
        }

        .comet2 .comet-tail {
            top: 4px;
            left: 4px;
            width: 180px;
            height: 3px;
            background: linear-gradient(to left, rgba(255, 240, 220, 0.95), rgba(255, 240, 220, 0));
        }

        .comet2 .comet-dust {
            top: 4px;
            left: 4px;
            width: 130px;
            height: 15px;
            background: linear-gradient(to left, rgba(255, 223, 186, 0.4), rgba(255, 223, 186, 0));
        }

        @keyframes cometFly2 {
            0% {
                top: 20%;
                left: 110%;
                transform: rotate(-20deg) scale(0.8);
                opacity: 0;
            }
            5% {
                opacity: 1;
                transform: rotate(-20deg) scale(1);
            }
            95% {
                opacity: 1;
                transform: rotate(-20deg) scale(1);
            }
            100% {
                top: 70%;
                left: -10%;
                transform: rotate(-20deg) scale(0.8);
                opacity: 0;
            }
        }

        /* Shooting Stars */
        .shooting-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background-color: white;
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
            z-index: 2;
            transform: translateZ(0);
        }

        .shooting-star::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100px;
            height: 1px;
            background: linear-gradient(to left, rgba(255, 255, 255, 0.8), transparent);
            transform-origin: right center;
            transform: rotate(180deg);
            filter: blur(0.5px);
        }

        @keyframes shootingStar {
            0% {
                transform: translateX(0) translateY(0) scale(1);
                opacity: 1;
            }
            20% {
                opacity: 1;
                transform: translateX(calc(-20vw - 40px)) translateY(calc(20vh + 40px)) scale(1.2);
            }
            100% {
                transform: translateX(calc(-100vw - 200px)) translateY(calc(100vh + 200px)) scale(0.8);
                opacity: 0;
            }
        }

        #map-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            z-index: 1;
            transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            perspective: 1000px; /* Add 3D perspective for depth */
        }

        .knowledge-map {
            position: relative;
            width: 100%;
            height: 5000px; /* Extra space for scrolling */
            padding-top: 2500px; /* Position starting point near bottom */
            transform-style: preserve-3d; /* Enable 3D transformations */
        }

        /* Enhanced Node Styling */
        .node {
            position: absolute;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 10;
            font-size: calc(0.12em + 0.5vmin);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px); /* For Safari */
            overflow: hidden;
            will-change: transform, opacity; /* Performance optimization */
            transform: translateZ(0); /* Force GPU acceleration */
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .node::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 50%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            z-index: -1;
            animation: rotateGradient 6s linear infinite;
            opacity: 0.7;
        }

        @keyframes rotateGradient {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
            100% { transform: rotate(360deg); }
        }

        .node::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.2), transparent 70%);
            z-index: -1;
            opacity: 0.8;
        }

        .node:hover {
            transform: scale(1.15) translateZ(20px);
            z-index: 20;
            box-shadow: 
                0 0 15px rgba(255, 255, 255, 0.5),
                0 0 30px rgba(255, 255, 255, 0.2),
                0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .node-label {
            padding: 5px;
            pointer-events: none;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 500;
            letter-spacing: 0.5px;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.8), 0 2px 4px rgba(0, 0, 0, 0.5);
            transform: translateZ(5px);
        }

        .base-node {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid rgba(255, 215, 0, 0.7);
            font-size: calc(0.65em + 0.7vmin);
            box-shadow: 
                0 0 15px rgba(255, 215, 0, 0.4),
                0 0 30px rgba(255, 215, 0, 0.2),
                inset 0 0 15px rgba(255, 215, 0, 0.2);
            animation: pulseBaseNode 4s infinite alternate;
        }

        @keyframes pulseBaseNode {
            0% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.4), 0 0 30px rgba(255, 215, 0, 0.2), inset 0 0 15px rgba(255, 215, 0, 0.2); }
            100% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.6), 0 0 40px rgba(255, 215, 0, 0.3), inset 0 0 25px rgba(255, 215, 0, 0.3); }
        }

        .level-1-node {
            background: rgba(135, 206, 235, 0.2);
            border: 2px solid rgba(135, 206, 235, 0.7);
            font-size: calc(0.65em + 0.6vmin);
            box-shadow: 
                0 0 15px rgba(135, 206, 235, 0.4),
                0 0 30px rgba(135, 206, 235, 0.2),
                inset 0 0 15px rgba(135, 206, 235, 0.2);
        }

        .level-2-node {
            background: rgba(144, 238, 144, 0.2);
            border: 2px solid rgba(144, 238, 144, 0.7);
            font-size: calc(0.3em + 0.8vmin);
            box-shadow: 
                0 0 15px rgba(144, 238, 144, 0.4),
                0 0 30px rgba(144, 238, 144, 0.2),
                inset 0 0 15px rgba(144, 238, 144, 0.2);
        }

        /* Enhanced Connection Lines */
        .line {
            position: absolute;
            background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0.1), 
                rgba(255, 255, 255, 0.3), 
                rgba(255, 255, 255, 0.1));
            transform-origin: 0 0;
            pointer-events: none;
            z-index: 5;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
            transform: translateZ(-5px); /* Push lines slightly back for depth */
        }

        /* Pulsating Connection Effect */
        .line.pulsating {
            animation: pulseLine 3s infinite;
            background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0.05), 
                rgba(255, 255, 255, 0.4), 
                rgba(255, 255, 255, 0.05));
        }

        @keyframes pulseLine {
            0%, 100% { opacity: 0.2; box-shadow: 0 0 5px rgba(255, 255, 255, 0.1); }
            50% { opacity: 0.6; box-shadow: 0 0 12px rgba(255, 255, 255, 0.3); }
        }

        /* Enhanced Content Panel Styling */
        .content-panel {
            position: fixed;
            top: 60%;
            left: 50%;
            transform: translate(-50%, 0);
            width: 90%;
            max-width: 600px;
            height: 40%;
            background: rgba(15, 15, 40, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            z-index: 100;
            display: none;
            flex-direction: column;
            color: white;
            box-shadow: 
                0 0 30px rgba(0, 0, 255, 0.3),
                0 0 60px rgba(0, 0, 255, 0.1),
                0 20px 40px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px); /* For Safari */
            will-change: transform, opacity; /* Performance optimization */
            transform-style: preserve-3d;
        }

        /* Glass morphism effect */
        .content-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0));
            border-radius: 15px;
            z-index: -1;
            opacity: 0.8;
        }

        /* Content formatting improvements */
        .content-preview, .content-full {
            padding: 25px;
            overflow-y: auto;
            flex-grow: 1;
            line-height: 1.7;
            font-weight: 300;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            transform: translateZ(0);
        }

        /* Style for expanded panel */
        .content-panel.expanded {
            border-radius: 0;
            box-shadow: none;
            background: rgba(15, 15, 40, 0.95);
            animation: expandPanel 0.5s cubic-bezier(0.19, 1, 0.22, 1) forwards;
        }

        @keyframes expandPanel {
            from { border-radius: 15px; }
            to { border-radius: 0; }
        }

        /* Dim the map when panel is expanded */
        .map-container.dimmed {
            filter: blur(8px) brightness(0.5);
            opacity: 0.5;
            pointer-events: none;
            transition: all 0.7s cubic-bezier(0.19, 1, 0.22, 1);
            transform: scale(0.98);
        }

        /* Adjust content title size for expanded view */
        .content-panel.expanded .content-title {
            font-size: 2.2rem;
            background: linear-gradient(90deg, #fff, #a0d8ef);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(160, 216, 239, 0.5);
            letter-spacing: -0.5px;
        }

        /* Make the close button more prominent in expanded view */
        .content-panel.expanded .close-button {
            font-size: 32px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            transform: rotate(0deg);
            transition: transform 0.5s ease;
        }

        /* Add visual hierarchy with headings */
        .content-preview h2, .content-full h2 {
            color: rgba(135, 206, 235, 1);
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 1px solid rgba(135, 206, 235, 0.4);
            padding-bottom: 10px;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-shadow: 0 0 15px rgba(135, 206, 235, 0.5);
            position: relative;
        }

        .content-preview h2::after, .content-full h2::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, rgba(135, 206, 235, 1), transparent);
            border-radius: 3px;
        }

        /* Improve paragraph readability */
        .content-preview p, .content-full p {
            margin-bottom: 18px;
            font-size: 1.05rem;
            text-shadow: 0 0 2px rgba(0, 0, 0, 0.8);
            letter-spacing: 0.3px;
            line-height: 1.8;
        }

        /* Add visual cues with bullets */
        .key-points {
            margin: 20px 0;
            padding-left: 20px;
        }

        .key-points li {
            margin-bottom: 12px;
            list-style-type: none;
            position: relative;
            padding-left: 25px;
            line-height: 1.6;
            transition: transform 0.2s ease;
        }

        .key-points li:hover {
            transform: translateX(5px);
        }

        .key-points li:before {
            content: "•";
            color: rgba(144, 238, 144, 1);
            font-size: 1.5em;
            position: absolute;
            left: 0;
            top: -5px;
            text-shadow: 0 0 10px rgba(144, 238, 144, 0.7);
            transition: all 0.2s ease;
        }

        .key-points li:hover:before {
            transform: scale(1.2);
            color: rgba(144, 238, 144, 1);
        }

        /* Highlight important concepts */
        .highlight {
            background: linear-gradient(90deg, rgba(70, 130, 180, 0.3), rgba(70, 130, 180, 0.1));
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
            border-left: 2px solid rgba(70, 130, 180, 0.8);
            text-shadow: 0 0 5px rgba(70, 130, 180, 0.5);
            position: relative;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .highlight:hover {
            background: linear-gradient(90deg, rgba(70, 130, 180, 0.4), rgba(70, 130, 180, 0.2));
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }

        /* Visual separator for sections */
        .content-separator {
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            margin: 25px 0;
            position: relative;
            overflow: visible;
        }

        .content-separator::before {
            content: '✧';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(15, 15, 40, 0.95);
            padding: 0 15px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            animation: rotateStar 6s linear infinite;
        }

        @keyframes rotateStar {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Related topics section */
        .related-topics {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            transform: translateZ(0);
        }

        .related-topics::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.5), 
                transparent);
        }

        .related-topics h3 {
            color: rgba(144, 238, 144, 1);
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-shadow: 0 0 10px rgba(144, 238, 144, 0.5);
            position: relative;
            display: inline-block;
        }

        .related-topics h3::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, rgba(144, 238, 144, 1), transparent);
            border-radius: 2px;
        }

        .related-topics ul {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            list-style-type: none;
            padding: 0;
        }

        .related-topics li {
            background: rgba(70, 130, 180, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(70, 130, 180, 0.5);
            box-shadow: 0 0 10px rgba(70, 130, 180, 0.2);
            position: relative;
            overflow: hidden;
        }

        .related-topics li::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: all 0.5s ease;
        }

        .related-topics li:hover {
            background: rgba(70, 130, 180, 0.5);
            transform: scale(1.08) translateY(-2px);
            box-shadow: 0 5px 15px rgba(70, 130, 180, 0.3);
        }

        .related-topics li:hover::before {
            left: 100%;
        }
        
        .content-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to bottom, 
                rgba(30, 30, 60, 0.9), 
                rgba(15, 15, 40, 0.7));
            position: relative;
            overflow: hidden;
        }

        .content-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.5), 
                transparent);
        }

        .content-title {
            font-size: 1.6rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .close-button {
            cursor: pointer;
            font-size: 26px;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
            position: relative;
            z-index: 1;
            transform: rotate(0deg);
        }

        .close-button:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
        }

        .show-more-button {
            display: block;
            margin: 25px auto 15px;
            padding: 12px 25px;
            background: linear-gradient(135deg, 
                rgba(70, 130, 180, 0.7), 
                rgba(70, 130, 180, 0.5));
            border: none;
            color: white;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-weight: 600;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
            transform: translateZ(0);
        }

        .show-more-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: all 0.5s ease;
        }

        .show-more-button:hover, .show-more-button:active {
            background: linear-gradient(135deg, 
                rgba(70, 130, 180, 0.8), 
                rgba(70, 130, 180, 0.6));
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
        }

        .show-more-button:hover::before {
            left: 100%;
        }

        /* Points system */
        .points-counter {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(15, 15, 40, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            padding: 12px 20px;
            color: white;
            font-size: 16px;
            z-index: 50;
            display: flex;
            align-items: center;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px); /* For Safari */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            transform: translateZ(0);
        }

        .points-counter:hover {
            background: rgba(15, 15, 40, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
        }

        .points-icon {
            margin-right: 12px;
            font-size: 20px;
            color: gold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
            animation: pulseStar 2s infinite alternate;
        }

        @keyframes pulseStar {
            0% { transform: scale(1); text-shadow: 0 0 10px rgba(255, 215, 0, 0.7); }
            100% { transform: scale(1.2); text-shadow: 0 0 15px rgba(255, 215, 0, 0.9); }
        }

        /* Star animation */
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            z-index: 0;
            will-change: transform, opacity; /* Performance optimization */
            transform: translateZ(0);
        }

        /* Large stars with glow */
        .star.large {
            box-shadow: 
                0 0 10px 2px rgba(255, 255, 255, 0.4),
                0 0 20px 5px rgba(255, 255, 255, 0.1);
            filter: blur(0.5px);
        }

        /* Twinkling stars */
        .star.twinkle {
            animation: twinkle 4s infinite ease-in-out;
            transform-origin: center center;
        }

        @keyframes twinkle {
            0% { opacity: 0.2; transform: scale(1) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(15deg); }
            100% { opacity: 0.2; transform: scale(1) rotate(0deg); }
        }

        /* Colored stars */
        .star.blue {
            background-color: #a0d8ef;
            box-shadow: 0 0 10px 2px rgba(160, 216, 239, 0.5);
        }

        .star.red {
            background-color: #ffb3ba;
            box-shadow: 0 0 10px 2px rgba(255, 179, 186, 0.5);
        }

        .star.yellow {
            background-color: #ffffba;
            box-shadow: 0 0 10px 2px rgba(255, 255, 186, 0.5);
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .node-label {
                font-size: 14px; /* Slightly larger for better readability */
                font-weight: 600; /* Bolder for better visibility */
                text-shadow: 0 0 8px rgba(0, 0, 0, 0.9); /* Stronger shadow for better contrast */
            }
            
            .content-panel {
                width: 95%;
                height: 80%; /* Slightly smaller to ensure it fits on mobile screens */
                top: 55%; /* Position it a bit higher */
                box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.3); /* Shadow from top for depth */
            }
            
            .content-title {
                font-size: 1.3rem;
            }

            .expanded .content-title {
                font-size: 1.5rem;
            }
            
            .points-counter, .progress-bar, .nav-helper {
                padding: 8px 12px;
                font-size: 14px;
                backdrop-filter: blur(8px); /* Stronger blur for better visibility */
            }
            
            /* Adjust content padding for mobile */
            .content-preview, .content-full {
                padding: 15px;
                line-height: 1.6; /* Slightly tighter line height for mobile */
            }
            
            /* Make buttons larger for touch targets */
            .close-button {
                width: 44px;
                height: 44px;
                font-size: 28px;
                background: rgba(255, 255, 255, 0.05); /* Subtle background for better visibility */
            }
            
            .show-more-button {
                padding: 14px 25px;
                font-size: 16px;
                width: 90%; /* Wider button for easier tapping */
                letter-spacing: 1px; /* Increased letter spacing for better readability */
            }
            
            /* Adjust quiz elements for mobile */
            .option {
                padding: 12px 15px; /* Larger touch target */
                margin-bottom: 8px; /* More space between options */
            }
            
            .option input[type="radio"] {
                width: 22px; /* Larger radio button */
                height: 22px;
                margin-right: 10px; /* More space after radio button */
            }
            
            /* Ensure comet is visible on mobile */
            .comet-head {
                width: 15px; /* Larger comet head */
                height: 15px;
                box-shadow: 
                    0 0 20px 6px rgba(255, 255, 255, 0.8),
                    0 0 40px 10px rgba(173, 216, 230, 0.6);
            }
            
            .comet-tail {
                width: 180px; /* Slightly shorter tail */
                height: 5px; /* Thicker tail */
                filter: blur(2px); /* Stronger blur for more dramatic effect */
            }
        }

        /* Verbesserte Navigation */
        .nav-helper {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(15, 15, 40, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            padding: 12px 20px;
            color: white;
            font-size: 16px;
            z-index: 50;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px); /* For Safari */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
            transform: translateZ(0);
        }

        .nav-helper:hover, .nav-helper:active {
            background: rgba(15, 15, 40, 0.9);
            transform: scale(1.05) translateY(-3px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
        }

        .nav-icon {
            font-size: 18px;
            color: rgba(135, 206, 235, 1);
            text-shadow: 0 0 10px rgba(135, 206, 235, 0.7);
            animation: pulseIcon 2s infinite alternate;
        }

        @keyframes pulseIcon {
            0% { transform: scale(1); }
            100% { transform: scale(1.2); }
        }

        /* Progress indicator */
        .progress-bar {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(15, 15, 40, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            padding: 10px 15px;
            z-index: 50;
            width: 180px;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px); /* For Safari */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateZ(0);
        }

        .progress-bar:hover {
            transform: scale(1.05) translateY(-2px);
            background: rgba(15, 15, 40, 0.9);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
        }

        .progress-inner {
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, 
                rgba(135, 206, 235, 0.9), 
                rgba(144, 238, 144, 0.9));
            width: 0%;
            transition: width 0.8s cubic-bezier(0.19, 1, 0.22, 1);
            box-shadow: 0 0 10px rgba(135, 206, 235, 0.5);
            position: relative;
            overflow: hidden;
        }

        .progress-inner::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.4), 
                transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .progress-text {
            text-align: center;
            color: white;
            font-size: 13px;
            margin-top: 5px;
            font-weight: 500;
            letter-spacing: 0.5px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        /* Connection animation */
        @keyframes pulse {
            0% { opacity: 0.2; box-shadow: 0 0 5px rgba(255, 255, 255, 0.1); }
            50% { opacity: 0.8; box-shadow: 0 0 15px rgba(255, 255, 255, 0.3); }
            100% { opacity: 0.2; box-shadow: 0 0 5px rgba(255, 255, 255, 0.1); }
        }

        .content-preview, .content-full {
            padding: 20px;
            position: relative;
        }
        
        .content-preview h2, .content-full h2 {
            font-size: 1.2rem;
            margin-top: 10px;
        }
        
        .content-preview p, .content-full p {
            font-size: 1rem;
            position: relative;
            z-index: 1;
        }
        
        .key-points li {
            font-size: 1rem;
            position: relative;
            z-index: 1;
        }
    
        .pulse {
            animation: pulse 2s infinite;
        }

        /* Animation für neue Knoten */
        @keyframes nodeAppear {
            0% {
                opacity: 0;
                transform: scale(0) rotate(-180deg);
            }
            60% {
                transform: scale(1.2) rotate(10deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        .node.appearing {
            animation: nodeAppear 1s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* Scrollbar-Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 15, 40, 0.3);
            border-radius: 10px;
            margin: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, 
                rgba(70, 130, 180, 0.7), 
                rgba(70, 130, 180, 0.5));
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: padding-box;
            transition: all 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, 
                rgba(70, 130, 180, 0.9), 
                rgba(70, 130, 180, 0.7));
            box-shadow: 0 0 10px rgba(70, 130, 180, 0.5);
        }

        /* Verbesserte Trennstriche */
        .thin-hr {
            border: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(224, 224, 224, 0.5), 
                transparent);
            margin: 25px 0;
            position: relative;
            overflow: visible;
        }

        .thin-hr::after {
            content: '•';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(15, 15, 40, 0.95);
            padding: 0 10px;
            color: rgba(224, 224, 224, 0.7);
            font-size: 10px;
            animation: pulseDot 3s infinite alternate;
        }

        @keyframes pulseDot {
            0% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1.3); }
        }

        /* Link-Stil */
        .custom-link {
            color: #4da6ff;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 12px;
            display: block;
            position: relative;
            padding-left: 5px;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .custom-link::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 1px;
            background: linear-gradient(90deg, #4da6ff, transparent);
            transition: width 0.3s ease;
        }

        .custom-link::after {
            content: '→';
            position: absolute;
            right: -20px;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .custom-link:hover, .custom-link:active {
            color: #80bdff;
            transform: translateX(3px);
            padding-right: 20px;
        }

        .custom-link:hover::before, .custom-link:active::before {
            width: 100%;
        }

        .custom-link:hover::after, .custom-link:active::after {
            right: 0;
            opacity: 1;
        }

        /* Listenspezifische Anpassungen */
        .custom-list {
            list-style-type: none;
            padding-left: 5px;
        }

        .custom-list li {
            margin-bottom: 18px;
            font-size: 16px;
            line-height: 1.7;
            position: relative;
            padding-left: 20px;
            transition: all 0.2s ease;
        }

        .custom-list li::before {
            content: '→';
            position: absolute;
            left: 0;
            color: rgba(135, 206, 235, 0.9);
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .custom-list li:hover {
            transform: translateX(5px);
        }

        .custom-list li:hover::before {
            color: rgba(135, 206, 235, 1);
            transform: scale(1.2);
        }

        h3 {
            font-size: 22px;
            margin-top: 35px;
            margin-bottom: 15px;
            color: rgba(144, 238, 144, 0.9);
            font-weight: 600;
            letter-spacing: 0.5px;
            text-shadow: 0 0 10px rgba(144, 238, 144, 0.3);
            position: relative;
            padding-bottom: 8px;
        }

        h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 2px;
            background: linear-gradient(90deg, 
                rgba(144, 238, 144, 0.9), 
                transparent);
            transition: width 0.3s ease;
        }

        h3:hover::after {
            width: 100px;
        }

        p {
            font-size: 16px;
            line-height: 1.7;
            margin-bottom: 22px;
            letter-spacing: 0.3px;
            position: relative;
            z-index: 1;
        }

        /* Quiz Styling Enhancement */
        .quiz-container {
            margin-top: 25px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px); /* For Safari */
            position: relative;
            overflow: hidden;
            transform: translateZ(0);
        }

        .quiz-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.05), transparent 70%);
            opacity: 0.5;
            z-index: -1;
            animation: rotateBg 30s linear infinite;
        }

        @keyframes rotateBg {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .start-quiz-button, .submit-quiz-button, .close-quiz-button, .retake-quiz-button {
            background: linear-gradient(135deg, #4a90e2, #3a7bc8);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 16px;
            cursor: pointer;
            margin: 15px 0;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-weight: 600;
            letter-spacing: 0.5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
            transform: translateZ(0);
        }

        .start-quiz-button::before, .submit-quiz-button::before, 
        .close-quiz-button::before, .retake-quiz-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: all 0.5s ease;
        }

        .start-quiz-button:hover, .submit-quiz-button:hover, 
        .close-quiz-button:hover, .retake-quiz-button:hover,
        .start-quiz-button:active, .submit-quiz-button:active, 
        .close-quiz-button:active, .retake-quiz-button:active {
            background: linear-gradient(135deg, #3a7bc8, #2a6cb8);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .start-quiz-button:hover::before, .submit-quiz-button:hover::before,
        .close-quiz-button:hover::before, .retake-quiz-button:hover::before {
            left: 100%;
        }
        
        .quiz-questions {
            padding: 15px;
        }
        
        .quiz-question {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .quiz-question::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .quiz-question:hover::before {
            opacity: 1;
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.1rem;
            letter-spacing: 0.3px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }
        
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.05), 
                transparent);
            transition: all 0.5s ease;
        }
        
        .option:hover, .option:active {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(3px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .option:hover::before {
            left: 100%;
        }
        
        .option input[type="radio"] {
            cursor: pointer;
            width: 18px;
            height: 18px;
            accent-color: #4a90e2;
            transition: all 0.2s ease;
        }

        .option input[type="radio"]:checked {
            transform: scale(1.2);
        }
        
        .option label {
            cursor: pointer;
            flex-grow: 1;
            font-size: 1rem;
            line-height: 1.5;
            transition: all 0.2s ease;
        }

        .option:hover label {
            transform: translateX(2px);
        }
        
        .quiz-controls {
            margin-top: 30px;
            text-align: center;
        }
        
        .quiz-results {
            margin-top: 25px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            animation: fadeIn 0.5s ease-out;
            position: relative;
            overflow: hidden;
        }

        .quiz-results::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.05), transparent 70%);
            opacity: 0.5;
            z-index: -1;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .correct-answer {
            border-left: 4px solid #4CAF50;
            background: linear-gradient(90deg, rgba(76, 175, 80, 0.15), rgba(76, 175, 80, 0.05));
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.1);
            animation: correctGlow 2s infinite alternate;
        }

        @keyframes correctGlow {
            0% { box-shadow: 0 3px 10px rgba(76, 175, 80, 0.1); }
            100% { box-shadow: 0 3px 15px rgba(76, 175, 80, 0.3); }
        }
        
        .wrong-answer {
            border-left: 4px solid #F44336;
            background: linear-gradient(90deg, rgba(244, 67, 54, 0.15), rgba(244, 67, 54, 0.05));
            box-shadow: 0 3px 10px rgba(244, 67, 54, 0.1);
        }
        
        .unanswered {
            border-left: 4px solid #FFC107;
            background: linear-gradient(90deg, rgba(255, 193, 7, 0.15), rgba(255, 193, 7, 0.05));
            box-shadow: 0 3px 10px rgba(255, 193, 7, 0.1);
        }
        
        .points-animation {
            position: absolute;
            color: #4CAF50;
            font-weight: bold;
            pointer-events: none;
            animation: float-up 1.5s ease-out forwards, fade-out 1.5s ease-out forwards;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
            font-size: 1.2rem;
            z-index: 100;
        }
        
        @keyframes float-up {
            0% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-60px) scale(1.2); }
            100% { transform: translateY(-120px) scale(1); }
        }
        
        @keyframes fade-out {
            0% { opacity: 1; }
            80% { opacity: 0.8; }
            100% { opacity: 0; }
        }

        /* Constellation Effect */
        .constellation {
            position: absolute;
            z-index: 1;
            pointer-events: none;
            opacity: 0.7;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.3));
        }

        .constellation-line {
            stroke: rgba(255, 255, 255, 0.2);
            stroke-width: 1px;
            stroke-dasharray: 5;
            stroke-dashoffset: 0;
            animation: dashAnimation 30s linear infinite;
        }

        @keyframes dashAnimation {
            to { stroke-dashoffset: 100; }
        }

        .constellation-star {
            fill: rgba(255, 255, 255, 0.8);
            filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.5));
            animation: twinkleStar 4s infinite alternate;
        }

        @keyframes twinkleStar {
            0% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        /* Dust particles effect */
        .dust-particle {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
            animation: floatDust 15s linear infinite;
            filter: blur(1px);
        }

        @keyframes floatDust {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.5; }
            50% { transform: translateY(-50px) translateX(25px) rotate(180deg); opacity: 0.5; }
            90% { opacity: 0.5; }
            100% { transform: translateY(-100px) translateX(50px) rotate(360deg); opacity: 0; }
        }

        /* Glowing effect for active nodes */
        .node.active {
            animation: nodeGlow 2s infinite alternate;
            z-index: 20;
        }

        @keyframes nodeGlow {
            0% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.5), 0 0 30px rgba(255, 255, 255, 0.2); }
            100% { box-shadow: 0 0 25px rgba(255, 255, 255, 0.7), 0 0 50px rgba(255, 255, 255, 0.4); }
        }

        /* Tooltip for nodes */
        .node-tooltip {
            position: absolute;
            background: rgba(15, 15, 40, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 100;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            max-width: 200px;
            backdrop-filter: blur(5px);-webkit-backdrop-filter: blur(5px); /* For Safari */
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: translateY(10px);
            will-change: opacity, transform;
        }

        .node:hover .node-tooltip {
            opacity: 1;
            transform: translateY(0);
        }

        /* Mobile-specific optimizations */
        @media (max-width: 480px) {
            /* Adjust UI elements for very small screens */
            .points-counter {
                top: 10px;
                right: 10px;
                padding: 8px 12px;
                font-size: 12px;
                border-radius: 20px; /* More rounded for mobile */
            }
            
            .progress-bar {
                top: 10px;
                left: 10px;
                width: 140px;
                padding: 8px 10px;
                border-radius: 20px; /* More rounded for mobile */
            }
            
            .nav-helper {
                bottom: 10px;
                left: 10px;
                padding: 8px 12px;
                font-size: 12px;
                border-radius: 20px; /* More rounded for mobile */
            }
            
            /* Make content more readable on small screens */
            .content-preview h2, .content-full h2 {
                font-size: 1.1rem;
                letter-spacing: 0.3px; /* Better readability */
            }
            
            .content-preview p, .content-full p {
                font-size: 0.95rem;
                letter-spacing: 0.2px; /* Better readability */
                line-height: 1.6; /* Tighter line height for small screens */
            }
            
            /* Ensure comet is visible on small screens */
            .comet-head {
                width: 18px; /* Even larger comet head for visibility */
                height: 18px;
                box-shadow: 
                    0 0 25px 8px rgba(255, 255, 255, 0.8),
                    0 0 50px 12px rgba(173, 216, 230, 0.6);
            }
            
            .comet-tail {
                width: 200px;
                height: 6px;
                filter: blur(3px); /* Stronger blur for more dramatic effect */
            }
            
            /* Enhance quiz visibility */
            .question-text {
                font-size: 1rem;
                letter-spacing: 0.2px; /* Better readability */
            }
            
            .option label {
                font-size: 0.95rem;
                letter-spacing: 0.2px; /* Better readability */
            }

            /* Adjust node size for better touch targets */
            .node {
                transform: scale(1.2);
            }

            .node:hover {
                transform: scale(1.4);
            }
        }

        /* High-DPI screen optimizations */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            /* Sharper text rendering */
            .node-label, .content-title, .content-preview p, .content-full p, 
            .key-points li, .question-text, .option label {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                text-rendering: optimizeLegibility;
            }
            
            /* Enhance visual elements */
            .comet-head, .comet-tail, .comet-dust {
                transform: translateZ(0); /* Force GPU rendering */
                will-change: transform, opacity;
            }
            
            /* Sharper borders */
            .node, .content-panel, .quiz-question, .option {
                border-width: 0.5px; /* Thinner borders for high-DPI */
            }

            /* Enhance shadows for high-DPI */
            .content-panel, .node:hover, .quiz-container {
                box-shadow: 0 0 30px rgba(0, 0, 255, 0.3),
                            0 0 60px rgba(0, 0, 255, 0.1),
                            0 20px 40px rgba(0, 0, 0, 0.4);
            }
        }

        @media (max-width: 768px) {
            #map-container {
                overflow-x: scroll; /* Erzwingt horizontales Scrollen auf mobilen Geräten */
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth; /* Smooth scrolling for better UX */
            }
            
            .knowledge-map {
                width: 1500px; /* Sicherstellen, dass die Breite auch auf Mobilgeräten groß genug ist */
                transform: scale(0.95); /* Slightly scale down for better fit */
                transform-origin: center top;
            }

            /* Enhance touch targets */
            .node {
                min-width: 40px;
                min-height: 40px;
            }

            /* Improve scrollbar visibility */
            ::-webkit-scrollbar {
                width: 10px;
                height: 10px;
            }

            ::-webkit-scrollbar-thumb {
                background: linear-gradient(to bottom, 
                    rgba(70, 130, 180, 0.8), 
                    rgba(70, 130, 180, 0.6));
                border-radius: 5px;
            }
        }

        /* Grundlegende Styles für den Home-Button */
        .home-button {
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            background-color: transparent;
            border: none;
            padding: 8px; /* Weniger Abstand für ein kompakteres Design */
            border-radius: 50%; /* Rundung für den Button */
            color: #fff8f8; /* Dunkle Farbe für den Button */
            position: absolute;
            top: 77px;  /* Etwas weiter unten als der obere Button */
            left: 20px; /* Etwas Abstand vom linken Rand */
            z-index: 1;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(3px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 40px;
            height: 40px;
        }

        /* Emoji-Styling */
        .home-icon {
            font-size: 20px; /* Kleinere Größe des Haus-Emojis */
            color: #f0f0f0; /* Hellere Farbe für bessere Sichtbarkeit */
            transition: all 0.3s ease;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        /* Hover-Effekt */
        .home-button:hover {
            background-color: rgba(255, 255, 255, 0.1); /* Subtiler Hintergrund beim Hover */
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .home-button:hover .home-icon {
            transform: scale(1.2);
            color: #ffffff;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        /* Active state for better feedback */
        .home-button:active {
            transform: scale(0.95);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Enhanced 3D effects for depth */
        .node, .content-panel, .quiz-container, .points-counter, .progress-bar, .nav-helper {
            transform-style: preserve-3d;
            backface-visibility: hidden;
        }

        /* Subtle parallax effect for stars */
        @media (hover: hover) {
            .star {
                transition: transform 0.1s ease-out;
            }
            
            .star.parallax-bg {
                transition: transform 0.3s ease-out;
            }
            
            .star.parallax-mid {
                transition: transform 0.2s ease-out;
            }
            
            .star.parallax-fg {
                transition: transform 0.1s ease-out;
            }
        }

        /* Enhanced loading animations */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .loading-shimmer {
            background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0.05), 
                rgba(255, 255, 255, 0.1), 
                rgba(255, 255, 255, 0.05));
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }

        /* Improved focus states for accessibility */
        button:focus, a:focus, input:focus {
            outline: 2px solid rgba(135, 206, 235, 0.6);
            outline-offset: 2px;
        }

        /* Subtle text selection styling */
        ::selection {
            background: rgba(70, 130, 180, 0.3);
            color: white;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        /* Enhanced node interaction */
        .node {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), 
                        box-shadow 0.3s ease, 
                        transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .node:active {
            transform: scale(0.95);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3), 
                        0 0 20px rgba(255, 255, 255, 0.1), 
                        inset 0 0 5px rgba(255, 255, 255, 0.2);
        }

        /* Improved content transitions */
        .content-panel {
            transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1),
                        transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1),
                        box-shadow 0.4s ease;
        }

        /* Enhanced button interactions */
        .show-more-button, .start-quiz-button, .submit-quiz-button, 
        .close-quiz-button, .retake-quiz-button {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275),
                        background 0.2s ease,
                        box-shadow 0.3s ease,
                        transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .show-more-button:active, .start-quiz-button:active, 
        .submit-quiz-button:active, .close-quiz-button:active, 
        .retake-quiz-button:active {
            transform: scale(0.95);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        /* Improved scrolling experience */
        html {
            scroll-behavior: smooth;
        }

        /* Enhanced content readability */
        .content-preview, .content-full {
            font-feature-settings: "kern", "liga", "clig", "calt";
            text-rendering: optimizeLegibility;
        }

        /* Subtle background animation */
        @keyframes backgroundShift {
            0% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }

        #universe {
            background: linear-gradient(125deg, rgba(26,32,44,0.8) 0%, rgba(8,9,22,0.9) 100%);
            background-size: 200% 200%;
            animation: backgroundShift 30s ease infinite;
        }
    </style>
</head>
<body>
    <canvas id="universe"></canvas>
    
    <div id="map-container">
        <div class="knowledge-map" id="knowledge-map"></div>
    </div>
    
    <div class="content-panel" id="content-panel">
        <div class="content-header">
            <div class="content-title" id="content-title">Node Title</div>
            <div class="close-button" id="close-button">&times;</div>
        </div>
        <div class="content-preview" id="content-preview"></div>
        <button class="show-more-button" id="show-more-button">Explore Deeper</button>
        <div class="content-full" id="content-full"></div>
    </div>
    
    <div class="points-counter">
        <span class="points-icon">✦</span>
        <span id="points-display">0 points</span>
    </div>
    
    <div class="progress-bar">
        <div class="progress-inner" id="progress-bar"></div>
        <div class="progress-text" id="progress-text">0% explored</div>
    </div>
    
    <div class="nav-helper" id="nav-helper">
        Return to Base
    </div>
    <!-- Home Button auf der Seite knowledge_map.html -->
    <a href="index.html" class="home-button">
        <span class="home-icon">→</span>
    </a>

    <script>
        // Configuration
        const config = {
            baseNodeSize: 120,
            level1NodeSize: 93,
            level2NodeSize: 50,
            lineWidth: 2,
            maxStars: 200,
            nodeSpacing: {
                level1: 300,
                level2: 200
            },
            starSizes: {
                min: 1,
                max: 3
            },
            starSpeed: {
                min: 0.05,
                max: 0.15
            },
            basePosition: { x: 0.5, y: 0.9 }, // Starting point position (relative to container)
            maxPoints: 0 // Will be set based on node count
        };

        // Knowledge structure
        const knowledgeStructure = {
            title: "Knowledge Base",
            description: "The foundation of all knowledge and understanding. This is where your journey begins.",
            content: "<h2>You’ve just unlocked the heart of your learning journey!</h2> <p>The <b>Knowledge Base</b> connects <b>Art & Creativity</b>, <b>Self-Mastery</b>, and <b>Philosophy</b> to help you grow in a unique way. It’s all about seeing how these areas link together to make you more <b>creative</b>, <b>focused</b>, and <b>thoughtful</b>.</p><br><h3>Quick Start:</h3> <p>Try the <i><b>\"Knowledge Web\"</b></i> exercise. Pick one idea from each area—like <b>Writing</b>, <b>Mindfulness</b>, and <b>Ethics</b>. Take <b>10 minutes</b> to write how they connect in your life (e.g., how <i>mindful writing</i> helps with <i>ethical decisions</i>). This will spark new insights and show you the bigger picture.</p><br><h3>Your Knowledge Base is your hub for growth.</h3> <p>Come back often to reflect and track your progress. <span style='font-weight: bold; color: #007bff;'>Ready to dive in?</span> <span style='font-style: italic;'>Which area will you explore first?</span></p>",

            children: [
                {
                    title: "Art & Creativity",
                    description: "Exploration of human creative skills and imagination, producing works to be appreciated for their beauty or emotional power.",
                    content: "Art & Creativity<br><hr class='thin-hr'><h3>1. Core Principles</h3><p>Creativity is not magic—it is structured problem-solving and the ability to combine old ideas in new ways. Every great artist, writer, and innovator follows specific mental processes to unlock creativity.</p><hr class='thin-hr'><h3>2. Foundational Knowledge</h3><ul class='custom-list'><li>The brain operates in two modes: Focused Mode (deliberate effort) and Diffuse Mode (subconscious problem-solving).</li><li>Creativity thrives when switching between these states through deep work and relaxation.</li><li>Constraints boost creativity: Limitations force new solutions.</li></ul><hr class='thin-hr'><h3>3. Practical Exercises</h3><ul class='custom-list'><li>10-Minute Constraints: Set a timer and create something within fixed rules (e.g., draw with only three colors, write a story with only 100 words).</li><li>Idea Splicing: Take two unrelated concepts and merge them into something new.</li><li>Reverse Engineering: Take an artwork, a piece of music, or a story and recreate it differently.</li></ul><hr class='thin-hr'><h3>4. Mastery Techniques</h3><ul class='custom-list'><li>Daily Creativity Rituals: Schedule time every day for creative output.</li><li>Divergent Thinking Challenges: Force yourself to generate at least 10 different solutions to a single problem.</li><li>Lifelong Learning: Study different disciplines (music, painting, architecture) to cross-pollinate ideas.</li></ul><hr class='thin-hr'><h3>5. Learn More</h3><hr class='thin-hr'><b>YouTube:</b><br><a href='https://youtu.be/B2bHy6o7i1A?si=m3D_ifquz9e3Fey0' class='custom-link'>How To Think Like History’s Greatest Genius - Michael Gelb</a><br><a href='https://youtu.be/kshboJxmU7k?si=xqW6gAMA4h88Pc0M' class='custom-link'>How to be a more creative person | Bill Stainton | TEDxStanleyPark</a><br><hr class='thin-hr'><b>Articles:</b><br><a href='https://pmc.ncbi.nlm.nih.gov/articles/PMC8305859/' class='custom-link'>Being Creative Makes You Happier: The Positive Effect of Creativity on Subjective Well-Being</a><br><a href='https://pmc.ncbi.nlm.nih.gov/articles/PMC6440443/' class='custom-link'>The Link Between Creativity, Cognition, and Creative Drives and Underlying Neural Mechanisms</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://amzn.to/41yV2za' class='custom-link'>The Creative Act: A Way of Being</a><br><a href='https://amzn.to/43Rjlei' class='custom-link'>How to Think Like Leonardo da Vinci: Seven Steps to Genius Every Day</a>",
                    children: [
                        {
                            title: "Architecture",
                            description: "The art and science of designing buildings and structures.",
                            content: "Architecture<br><hr class='thin-hr'><h3>1. Core Principles</h3><p>Architecture is the balance of aesthetic design, functionality, and structural integrity.</p><hr class='thin-hr'><h3>2. Foundational Knowledge</h3><ul class='custom-list'><li>Learn the Golden Ratio and proportion systems.</li><li>Study material properties and their impact on design.</li><li>Understand spatial psychology: How spaces affect human behavior.</li></ul><hr class='thin-hr'><h3>3. Practical Exercises</h3><ul class='custom-list'><li>Daily Sketching: Draw buildings with correct perspective.</li><li>Structure Breakdown: Analyze famous buildings and their blueprints.</li><li>Material Experimentation: Create small models using different materials.</li></ul><hr class='thin-hr'><h3>4. Mastery Techniques</h3><ul class='custom-list'><li>Form & Function Challenges: Design a space that maximizes both.</li><li>Historic Study: Learn how architecture evolved over centuries.</li><li>Real-World Observations: Visit buildings and sketch design improvements.</li></ul><hr class='thin-hr'><h3>5. Learn More</h3><hr class='thin-hr'><b>YouTube:</b><br><a href='https://www.youtube.com/watch?v=k4dVgbuxBAw' class='custom-link'>Architecture Short Course: How to Develop a Design Concept</a><br><a href='https://www.youtube.com/watch?v=KUjomyjbdQU' class='custom-link'>Architectural Design Process Explained</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://amzn.to/3XU0OKw' class='custom-link'>Architecture: A Visual History (DK Ultimate Guides)</a><br><a href='https://amzn.to/4iuauU3' class='custom-link'>The Architecture Book (DK Big Ideas)</a>"
                        },
                        {
                            title: "Arts",
                            description: "Art forms that create works that are primarily visual in nature.",
                            content: "Arts<br><hr class='thin-hr'><h3>1. Core Principles</h3><p>Art is about expressing ideas, emotions, and perspectives through visual forms. It has technical aspects (color theory, composition) and emotional depth.</p><hr class='thin-hr'><h3>2. Foundational Knowledge</h3><ul class='custom-list'><li>Study composition rules: Rule of thirds, balance, negative space.</li><li>Learn color psychology: How colors evoke emotions.</li><li>Understand light and shadow: Contrast is key to realism and depth.</li></ul><hr class='thin-hr'><h3>3. Practical Exercises</h3><ul class='custom-list'><li>Daily Sketching: Draw simple objects with different lighting angles.</li><li>Master Imitation: Recreate a famous painting, then change one element.</li><li>Minimalism Challenge: Create an artwork using only two colors and five shapes.</li></ul><hr class='thin-hr'><h3>4. Mastery Techniques</h3><ul class='custom-list'><li>Storytelling in Art: Every piece should communicate an idea.</li><li>Portfolio Evolution: Constantly refine and critique your past works.</li><li>Multi-Medium Exploration: Experiment with digital, sculpture, and mixed media.</li></ul><hr class='thin-hr'><h3>5. Learn More</h3><hr class='thin-hr'><b>YouTube:</b><br><a href='https://youtu.be/v3MsfZ-wjzA?si=xn3f8I9rhw9VrhUp' class='custom-link'>How to shade everything</a><br><a href='https://www.youtube.com/watch?v=ewMksAbgdBI&list=PL1HIh25sbqZnkA1T09UtVHoyjYaMJuK0a' class='custom-link'>Learn to Draw</a><br><hr class='thin-hr'><b>Articles:</b><br><a href='https://uxpamagazine.org/design_like_da_vinci/' class='custom-link'>Design Like da Vinci: Sketching Lessons from the Original Renaissance Man</a><br><a href='https://www.researchgate.net/publication/261698095_Research_in_Art_and_Design_a_common_ground_between_science_and_creative_practice' class='custom-link'>Research in Art and Design: A common ground between science and creative practice</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://amzn.to/4kpNh7j' class='custom-link'>How to Draw Cool Stuff: A Drawing Guide for Teachers and Students</a><br><a href='https://amzn.to/4kpNqaR' class='custom-link'>Leonardo Da Vinci and Anatomy: The Mechanics of Life</a><br><a href='https://amzn.to/43NdB5i' class='custom-link'>Leonardo da Vinci: A Life in Drawing</a>"
                        },
                        {
                            title: "Music",
                            description: "The art of arranging sounds in time to produce a composition.",
                            content: "Music<br><hr class='thin-hr'><h3>1. Core Principles</h3><p>Music is the structured manipulation of sound and rhythm. True mastery blends technical skill with emotional intuition.</p><hr class='thin-hr'><h3>2. Foundational Knowledge</h3><ul class='custom-list'><li>Musical Structure: Understand chord progressions, scales, and modes.</li><li>Ear Training: Recognize intervals, harmonies, and key changes.</li><li>Rhythm Mastery: Internalize different time signatures and syncopation.</li></ul><hr class='thin-hr'><h3>3. Practical Exercises</h3><ul class='custom-list'><li>Daily Ear Training: Identify notes and chords by ear.</li><li>Minimalist Composition: Write a melody using only three notes.</li><li>Rhythm Challenge: Tap complex beats and improvise variations.</li></ul><hr class='thin-hr'><h3>4. Mastery Techniques</h3><ul class='custom-list'><li>Song Deconstruction: Analyze famous compositions to understand their structure.</li><li>Improvisation Sessions: Experiment freely to develop musical instincts.</li><li>Cross-Genre Study: Explore different styles to broaden your musical vocabulary.</li></ul><hr class='thin-hr'><h3>5. Learn More</h3><hr class='thin-hr'><b>Articles:</b><br><a href='https://en.blog.newzik.com/blog/conseils-apprendr-composer-premier-morceau-musique' class='custom-link'>Tips for learning to compose music</a><br><a href='https://suno.com/home' class='custom-link'>Create music with AI</a><br><hr class='thin-hr'><b>YouTube:</b><br><a href='https://youtu.be/ZdhdC2wx2Ew?si=4ZRPYhIbz090mAQg' class='custom-link'>How to create music</a><br><a href='https://youtu.be/mdJU5ogrPMY?si=2fIwb_fl2AHwaZtN' class='custom-link'>Classical music for studying</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://amzn.to/4iPKEdc' class='custom-link'>Music Beginner Guide</a><br><a href='https://amzn.to/4itCGX5' class='custom-link'>100 of the Most Beautiful Piano Pieces (Sheet Music)</a>"
                        },
                        {
                            title: "Writing",
                            description: "Original composition that expresses ideas, thoughts or emotions in a literary form.",
                            content: "Writing<br><hr class='thin-hr'><h3>1. Core Principles</h3><p>Writing is the art of communicating ideas clearly and effectively through the written word. Whether creative, academic, or professional, good writing conveys meaning in a way that resonates with readers.</p><hr class='thin-hr'><h3>2. Foundational Knowledge</h3><ul class='custom-list'><li><b>Structure and Organization:</b> Clear organization enhances readability (Introduction, Body, Conclusion).</li><li><b>Style and Voice:</b> Develop a unique writing style appropriate for the context.</li><li><b>Grammar and Syntax:</b> Mastering language rules ensures clarity.</li><li><b>Audience Awareness:</b> Tailor content to the needs of your readers.</li></ul><hr class='thin-hr'><h3>3. Practical Exercises</h3><ul class='custom-list'><li><b>Outline Your Ideas:</b> Structure thoughts before writing.</li><li><b>Daily Writing Practice:</b> Write 500 words daily to build fluency.</li><li><b>Read Aloud:</b> Identify awkward phrasing and errors.</li><li><b>Focus on Clarity:</b> Express complex ideas simply.</li></ul><hr class='thin-hr'><h3>4. Mastery Techniques</h3><ul class='custom-list'><li><b>Peer Review and Feedback:</b> Refine style through critique.</li><li><b>Experiment with Genres:</b> Gain versatility by exploring different formats.</li><li><b>Edit Ruthlessly:</b> Remove unnecessary elements.</li><li><b>Strong Introductions and Conclusions:</b> Hook readers and leave impact.</li><li><b>Master Storytelling:</b> Even non-fiction benefits from compelling narratives.</li><li><b>Use Advanced Stylistic Devices:</b> Employ metaphor, allegory, and symbolism.</li></ul><hr class='thin-hr'><h3>5. Learn More</h3><hr class='thin-hr'><b>Resources:</b><br><a href='https://jordanbpeterson.com/wp-content/uploads/2018/02/Essay_Writing_Guide.docx' class='custom-link'>Essay Writing Guide</a><br><a href='https://craigdilouie.com/this-is-your-brain-on-writing/' class='custom-link'>This is Your Brain on Writing – Craig DiLouie</a><br><hr class='thin-hr'><b>YouTube:</b><br><a href='https://youtu.be/Kwjw2J6ByJo?si=11zdJGPF9GkoX1sY' class='custom-link'>Jordan Peterson on Writing</a><br><a href='https://youtu.be/65U5byDZ55M?si=Nf5zdstYT5kYGIJL' class='custom-link'>How to Use Writing to Improve Your Thinking</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://amzn.to/4hClyNR' class='custom-link'>How to Write It</a><br><a href='https://amzn.to/4bGKG4P' class='custom-link'>How to Write Poetry</a>"
                        }
                    ]
                },
            
                {
                    title: "Philosophy",
                    description: "The study of fundamental questions about existence, knowledge, values, reason, mind, and language.",
                    content: "Philosophy<br><hr class='thin-hr'><h3>1. Core Principles</h3><p>Philosophy explores existence, knowledge, ethics, and reason—training the mind for clarity and logical thought.</p><hr class='thin-hr'><h3>2. Foundational Knowledge</h3><ul class='custom-list'><li>Question Everything: Challenge assumptions rigorously.</li><li>Schools of Thought: Stoicism, Existentialism, Rationalism, etc.</li><li>Applied Philosophy: Ideas must have real-world impact.</li></ul><hr class='thin-hr'><h3>3. Practical Exercises</h3><ul class='custom-list'><li>Daily Thought Experiment: Challenge one belief per day.</li><li>Philosophical Debates: Defend a viewpoint you disagree with.</li><li>Read Primary Sources: Engage with original philosophical texts.</li></ul><hr class='thin-hr'><h3>4. Mastery Techniques</h3><ul class='custom-list'><li>Logical Breakdown: Identify fallacies in arguments.</li><li>Writing Philosophical Essays: Develop precise articulation of ideas.</li><li>Living Philosophy: Apply philosophical principles to daily choices.</li></ul><hr class='thin-hr'><h3>5. Learn More</h3><hr class='thin-hr'><b>Articles:</b><br><a href='https://www.swarthmore.edu/writing/philosophy-writing-guide' class='custom-link'>Philosophy Writing Guide</a><br><a href='https://www.thephilosophyman.com/blog/16-ways-to-create-philosophical-questions' class='custom-link'>16 Ways to Create Philosophical Questions</a><br><hr class='thin-hr'><b>YouTube:</b><br><a href='https://youtu.be/hlFOlJ_qZI0?si=qg-gABCFXzhXOcH4' class='custom-link'>Every Philosophical Ideology Explained</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://amzn.to/4hJjZO9' class='custom-link'>The World as Will and Representation (Schopenhauer)</a><br><a href='https://amzn.to/3DJg71Y' class='custom-link'>The World as Will and Representation Vol. 2</a><br><a href='https://amzn.to/41AeFa4' class='custom-link'>Friedrich Nietzsche Books</a><br><a href='https://amzn.to/4kuuVSz' class='custom-link'>Immanuel Kant Books</a><br><a href='https://amzn.to/4kwMhyc' class='custom-link'>Stoicism (Ancient Philosophies)</a><br><a href='https://amzn.to/41VJrdp' class='custom-link'>Meditations (Marcus Aurelius)</a><br><a href='https://amzn.to/43PMO8k' class='custom-link'>The Art of War</a><br><a href='https://amzn.to/3FAVC88' class='custom-link'>Plato Complete Works</a>",
                    children: [
                        {
                            title: "Metaphysics",
                            description: "Branch of philosophy dealing with the fundamental nature of reality.",
                            content: "Metaphysics<br><hr class='thin-hr'><h3>1. Core Principles</h3><p>Metaphysics explores reality, existence, and what lies beyond the physical world. It asks fundamental questions: What is real? What is the nature of time, space, and consciousness?</p><hr class='thin-hr'><h3>2. Foundational Knowledge</h3><ul class='custom-list'><li>Ontology: The study of existence and being (What exists?).</li><li>Dualism vs. Materialism: Does only the physical world exist, or is there more?</li><li>The Nature of Time & Space: Are time and space real or just concepts?</li><li>Consciousness & Free Will: Is the mind separate from the body?</li></ul><hr class='thin-hr'><h3>3. Practical Exercises</h3><ul class='custom-list'><li>Question Assumptions: Ask, 'What if reality is not what I think it is?'</li><li>Mind-Body Reflection: Observe your own consciousness. Is it separate from your body?</li><li>Simulated Reality Thought Experiment: How would you know if you're in a simulation?</li><li>Categorize Existence: List things that exist (physical, abstract, mental).</li></ul><hr class='thin-hr'><h3>4. Mastery Techniques</h3><ul class='custom-list'><li>Debate the Nature of Reality: Argue both for and against materialism.</li><li>Compare Philosophical Theories: Analyze Plato’s Forms vs. Aristotle’s substance.</li><li>Apply Metaphysics to Science: Study how physics interacts with metaphysics (e.g., quantum mechanics).</li><li>Develop Your Own Theory: Write a structured argument about the nature of reality.</li></ul><hr class='thin-hr'><h3>5. Learn More</h3><hr class='thin-hr'><b>Articles:</b><br><a href='https://en.wikipedia.org/wiki/Metaphysics' class='custom-link'>Metaphysics (Wikipedia)</a><br><a href='https://plato.stanford.edu/entries/metaphysics/' class='custom-link'>Stanford Encyclopedia of Philosophy - Metaphysics</a><br><hr class='thin-hr'><b>YouTube:</b><br><a href='https://youtu.be/qKq0Afmsj-U?si=oY3AGXXUmBL1gPpz' class='custom-link'>Introduction to Metaphysics</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://amzn.to/4bykyJs' class='custom-link'>Metaphysics by Aristotle</a>"
                        },
                        {
                            title: "Ethics",
                            description: "Branch of philosophy that involves systematizing, defending, and recommending concepts of right and wrong behavior.",
                            content: "Ethics<br><hr class='thin-hr'><h3>1. Core Principles</h3><p>Ethics is the study of morality, right and wrong, and how we should act. It influences personal behavior, law, and society.</p><hr class='thin-hr'><h3>2. Foundational Knowledge</h3><ul class='custom-list'><li>Virtue Ethics (Aristotle): Being good is about cultivating virtues like courage and wisdom.</li><li>Deontology (Kant): Moral duties are absolute, regardless of consequences.</li><li>Utilitarianism (Mill, Bentham): Actions are right if they maximize happiness.</li><li>Moral Relativism vs. Objectivism: Are ethics universal or culture-dependent?</li></ul><hr class='thin-hr'><h3>3. Practical Exercises</h3><ul class='custom-list'><li>Moral Dilemma Reflection: What would you do in a life-or-death situation?</li><li>Apply Ethical Theories: Justify a real-life decision using Kantian ethics vs. Utilitarianism.</li><li>Analyze Your Own Moral Code: Write down your top 3 ethical principles.</li><li>Moral Case Studies: Study historical moral dilemmas (e.g., Just War Theory).</li></ul><hr class='thin-hr'><h3>4. Mastery Techniques</h3><ul class='custom-list'><li>Engage in Ethical Debates: Defend and critique moral theories.</li><li>Explore Game Theory & Ethics: How does cooperation evolve?</li><li>Test Ethical Principles in Action: Live by a strict ethical rule for one week.</li><li>Study Ethics in AI & Tech: Consider how ethics applies to modern challenges (e.g., AI decision-making).</li></ul><hr class='thin-hr'><h3>5. Learn More</h3><hr class='thin-hr'><b>Articles:</b><br><a href='https://en.wikipedia.org/wiki/Ethics' class='custom-link'>Learn about Ethics (Wikipedia)</a><br><hr class='thin-hr'><b>YouTube:</b><br><a href='https://youtu.be/DLCUn6h7qRo?si=ULrzDRo1rBZ3V0W2' class='custom-link'>The Fastest Ethics Course</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://amzn.to/4hJ1TMm' class='custom-link'>Ethics (Book)</a>"
                        },
                        {
                            title: "Epistemology",
                            description: "Branch of philosophy concerned with the theory of knowledge.",
                            content: "Epistemology<br><hr class='thin-hr'><h3>1. Core Principles</h3><p>Epistemology is the study of knowledge—what it is, how we get it, and how we can be certain of anything.</p><hr class='thin-hr'><h3>2. Foundational Knowledge</h3><ul class='custom-list'><li>Rationalism vs. Empiricism: Is knowledge gained through reason (Descartes) or experience (Locke)?</li><li>The Problem of Skepticism: Can we know anything for sure?</li><li>Justified True Belief: What makes a belief 'true' and 'justified'?</li><li>The Role of Perception: How much do our senses deceive us?</li></ul><hr class='thin-hr'><h3>3. Practical Exercises</h3><ul class='custom-list'><li>Identify Your Own Biases: Reflect on what beliefs you take for granted.</li><li>Test a Knowledge Claim: Find evidence for and against something you 'know.'</li><li>Philosophical Skepticism Exercise: Question whether you can prove anything with absolute certainty.</li><li>Analyze News & Media: How do you know if something is true?</li></ul><hr class='thin-hr'><h3>4. Mastery Techniques</h3><ul class='custom-list'><li>Write a Knowledge Hierarchy: Organize what you know from most to least certain.</li><li>Defend an Epistemological Position: Argue for rationalism, empiricism, or skepticism.</li><li>Use Bayesian Thinking: Update beliefs based on new evidence.</li><li>Study Cognitive Science & AI: Explore how knowledge and learning work in artificial intelligence.</li></ul><hr class='thin-hr'><h3>5. Learn More</h3><hr class='thin-hr'><b>Articles:</b><br><a href='https://en.wikipedia.org/wiki/Epistemology' class='custom-link'>Epistemology (Wikipedia)</a><br><a href='https://onlinelibrary.wiley.com/doi/abs/10.1002/tea.21257' class='custom-link'>Epistemologies in Practice</a><br><hr class='thin-hr'><b>YouTube:</b><br><a href='https://youtu.be/r_Y3utIeTPg?si=ss159RzU1H2nGeOr' class='custom-link'>Theory of Epistemology</a><br><a href='https://youtu.be/L1MB0l74Onc?si=4MGu-n2lSUTYv7T_' class='custom-link'>Epistemology - A Beginner's Guide</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://amzn.to/3DNncyA' class='custom-link'>Epistemology: A Contemporary Introduction to the Theory of Knowledge</a>"
                        },
                        {
                            title: "Logic",
                            description: "The systematic study of valid inference and reasoning.",
                            content: "Logic<br><hr class='thin-hr'><h3>1. Core Principles</h3><p>Logic is the foundation of clear thinking and rational decision-making.</p><hr class='thin-hr'><h3>2. Foundational Knowledge</h3><ul class='custom-list'><li>Deductive vs. Inductive Reasoning: Absolute proof vs. probability.</li><li>Logical Fallacies: Learn to spot flawed arguments.</li><li>Syllogisms & Proofs: Train structured thinking.</li></ul><hr class='thin-hr'><h3>3. Practical Exercises</h3><ul class='custom-list'><li>Daily Logical Puzzle: Solve a reasoning problem daily.</li><li>Fallacy Hunting: Identify errors in everyday conversations.</li><li>Argue Like a Philosopher: Defend a position with pure logic.</li></ul><hr class='thin-hr'><h3>4. Mastery Techniques</h3><ul class='custom-list'><li>Socratic Questioning: Ask deeper follow-up questions.</li><li>Formal Logic Practice: Study symbolic logic and proofs.</li><li>Applied Rationality: Use logic in financial, political, and ethical decisions.</li></ul><hr class='thin-hr'><h3>5. Learn More</h3><hr class='thin-hr'><b>Articles:</b><br><a href='https://onlinelibrary.wiley.com/doi/book/10.1002/9781405164801' class='custom-link'>The Blackwell Guide to Logic</a><br><hr class='thin-hr'><b>YouTube:</b><br><a href='https://youtu.be/R2zElslG_tE?si=_KhwGS_KwdVl9hXb' class='custom-link'>Introduction to Logic</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://amzn.to/3RfS51u' class='custom-link'>Socratic Logic</a><br><a href='https://amzn.to/4bDhXhs' class='custom-link'>Aristotle - The Organon</a><br><a href='https://amzn.to/3DPAquz' class='custom-link'>Aristotle's Categories & Propositions</a><br><a href='https://amzn.to/3FA1Cy5' class='custom-link'>The Power of Logical Thinking - Marilyn Vos Savant</a>"
                        }
                    ]
                },
                {
                    title: "Self-Mastery",
                    description: "Activities that improve awareness and identity, develop talents and potential, and contribute to the realization of dreams and aspirations.",
                    content: "<h2>Self-Mastery</h2><br><h3>1. Core Principles:</h3><p>Self-mastery is the ability to control emotions, habits, and actions to achieve long-term goals. It is built through self-awareness and discipline.</p><br><h3>2. Foundational Knowledge:</h3><ul class='custom-list'><li><b>Know Your Weaknesses:</b> Identify what holds you back.</li><li><b>Delayed Gratification:</b> Short-term pain leads to long-term success.</li><li><b>Identity Shaping:</b> Actions shape who you become.</li></ul><br><h3>3. Practical Exercises:</h3><ul class='custom-list'><li><b>Daily Self-Assessment:</b> Reflect on three key wins and mistakes.</li><li><b>Temptation Resistance:</b> Delay a reward for 10 minutes every day.</li><li><b>Self-Identity Writing:</b> Define who you want to be and act accordingly.</li></ul><br><h3>4. Mastery Techniques:</h3><ul class='custom-list'><li><b>Accountability Systems:</b> Track habits publicly or with a partner.</li><li><b>Stress Testing:</b> Put yourself in difficult situations to grow resilience.</li><li><b>Hard Choices Training:</b> Regularly choose the harder but better path.</li></ul><br><h3>5. Learn More:</h3><hr class='thin-hr'><b>Articles:</b><br><a href='https://dobetterwithdan.wordpress.com/2020/11/12/self-mastery-self-discipline-and-freedom/' class='custom-link'>What is Self-Mastery</a><br><hr class='thin-hr'><b>YouTube:</b><br><a href='https://youtu.be/7hIIKxEQrmg?si=UrJCZV2aRD2ID77T' class='custom-link'>Way to Self-Master yourself</a><br><a href='https://youtu.be/SWE_Da6UUBI?si=qKwMc-IMu6CWrYYW' class='custom-link'>Self-Mastery Philosophical Guide</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://shaolin.online/de' class='custom-link'>Shaolin Self-Mastery</a><br><a href='https://amzn.to/43SzC2C' class='custom-link'>Self-Mastery</a>",
                    children: [
                        {
                            title: "Leadership",
                            description: "The art of motivating a group of people to act toward achieving a common goal.",
                            content: "<h2>Leadership</h2><br><h3>1. Core Principles:</h3><p>Leadership is about influence, responsibility, and decision-making. Great leaders inspire rather than command.</p><br><h3>2. Foundational Knowledge:</h3><ul class='custom-list'><li><b>Lead by Example:</b> People follow actions, not words.</li><li><b>Communication is Key:</b> Clarity and persuasion matter more than authority.</li><li><b>Emotional Intelligence:</b> Understanding people is more important than technical skill.</li></ul><br><h3>3. Practical Exercises:</h3><ul class='custom-list'><li><b>Daily Decision Review:</b> Analyze one leadership choice each day.</li><li><b>Difficult Conversations:</b> Initiate one uncomfortable but necessary talk per week.</li><li><b>Rapid Delegation:</b> Identify tasks others can do and assign them.</li></ul><br><h3>4. Mastery Techniques:</h3><ul class='custom-list'><li><b>Crisis Simulation:</b> Train decision-making under stress.</li><li><b>Reverse Leadership:</b> Let someone else lead and give feedback.</li><li><b>Ethical Dilemmas:</b> Study history’s toughest leadership decisions.</li></ul><br><h3>5. Learn More:</h3><hr class='thin-hr'><b>Articles:</b><br><a href='https://www.success.com/8-essential-qualities-of-successful-leaders/' class='custom-link'>8 Essential Qualities of Leadership</a><br><hr class='thin-hr'><b>YouTube:</b><br><a href='https://youtu.be/XWVwFVgA4b4?si=VZYsFVviwojoYhOS' class='custom-link'>Jordan Peterson's Guide to Leadership</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://amzn.to/4kWVCPS' class='custom-link'>21 Irrefutable Laws of Leadership</a>"
                        },
                        {
                            title: "Discipline",
                            description: "Training to establish self-control and willpower to achieve consistent results.",
                            content: "<h2>Discipline</h2><br><h3>1. Core Principles:</h3><p>Discipline is the ability to take consistent action regardless of motivation. It is built through routine, commitment, and resilience.</p><br><h3>2. Foundational Knowledge:</h3><ul class='custom-list'><li><b>Habits &gt; Motivation:</b> Willpower is unreliable; systems are key.</li><li><b>Time Blocking:</b> Schedule tasks to remove decision fatigue.</li><li><b>Momentum Matters:</b> Small wins lead to bigger progress.</li></ul><br><h3>3. Practical Exercises:</h3><ul class='custom-list'><li><b>Non-Negotiable Task:</b> Pick one task you must do daily, no matter what.</li><li><b>5-Second Rule:</b> Take action within five seconds before excuses form.</li><li><b>Environmental Control:</b> Remove distractions before starting work.</li></ul><br><h3>4. Mastery Techniques:</h3><ul class='custom-list'><li><b>Pre-Commitment:</b> Announce goals publicly for accountability.</li><li><b>Pain Exposure:</b> Embrace discomfort to train mental toughness.</li><li><b>Failure Tracking:</b> Analyze missed tasks and improve systems.</li></ul><br><h3>5. Learn More:</h3><hr class='thin-hr'><b>Research Papers:</b><br><a href='https://www.diva-portal.org/smash/get/diva2:1248151/FULLTEXT01.pdf' class='custom-link'>Research Paper on Discipline</a><br><hr class='thin-hr'><b>Articles:</b><br><a href='https://livingwithlimerence.com/the-neuroscience-of-temptation/' class='custom-link'>The Neuroscience of Discipline</a><br><hr class='thin-hr'><b>YouTube:</b><br><a href='https://youtu.be/W2Jzkl8J2nM?si=vu0WV-ISYNUi5Q2F' class='custom-link'>Why Being Disciplined Makes You Successful</a><br><a href='https://youtu.be/k0ytdAqRpE4?si=Ns1Aa_yJ-nwhdIV4' class='custom-link'>A Guide to Extreme Self-Discipline</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://amzn.to/4hFNxw6' class='custom-link'>Discipline Equals Freedom</a>"
                        },
                        {
                            title: "Emotional Intelligence",
                            description: "The capacity to be aware of, control, and express one's emotions, and to handle interpersonal relationships judiciously and empathetically.",
                            content: "<h2>Emotional Intelligence</h2><br><h3>1. Core Principles:</h3><p>Emotional intelligence is the ability to understand, regulate, and respond to emotions—both your own and others’.</p><br><h3>2. Foundational Knowledge:</h3><ul class='custom-list'><li><b>Self-Awareness:</b> Recognize and name your emotions.</li><li><b>Empathy Matters:</b> Understanding others is a skill.</li><li><b>Emotions Influence Logic:</b> Decisions are never purely rational.</li></ul><br><h3>3. Practical Exercises:</h3><ul class='custom-list'><li><b>Emotional Journaling:</b> Track your moods and triggers daily.</li><li><b>Empathy Mapping:</b> Try to see situations from another’s perspective.</li><li><b>Pause Before Reacting:</b> Wait 5 seconds before responding emotionally.</li></ul><br><h3>4. Mastery Techniques:</h3><ul class='custom-list'><li><b>Role Reversal:</b> Argue the opposite side of a conflict.</li><li><b>Social Pattern Recognition:</b> Identify common emotional triggers in others.</li><li><b>Mindful Listening:</b> Focus 100% on what someone says without forming a response.</li></ul><br><h3>5. Learn More:</h3><hr class='thin-hr'><b>Research Paper:</b><br><a href='https://pmc.ncbi.nlm.nih.gov/articles/PMC6014059/#:~:text=Emerging%20neuroscience%20studies%20have%20revealed,Krueger%20et%20al.%2C%202009%3B' class='custom-link'>Emotional Intelligence and Your Brain</a><br><hr class='thin-hr'><b>YouTube:</b><br><a href='https://youtu.be/kG5Qb9sr0YQ?si=3zMUMJFQASMYZN2W' class='custom-link'>How to Improve Emotional Intelligence</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://amzn.to/41u6LPv' class='custom-link'>How to Master Emotional Intelligence</a>"
                        },
                        {
                            title: "Mindfulness",
                            description: "The psychological process of purposely bringing one's attention to experiences occurring in the present moment without judgment.",
                            content: "<h2>Mindfulness</h2><br><h3>1. Core Principles:</h3><p>Mindfulness is the practice of awareness without judgment, leading to better focus, emotional control, and well-being.</p><br><h3>2. Foundational Knowledge:</h3><ul class='custom-list'><li><b>Attention is a Skill:</b> Training focus improves all areas of life.</li><li><b>Thoughts are not Reality:</b> Observing thoughts reduces stress.</li><li><b>The Present Moment Matters:</b> The past and future only exist in your mind.</li></ul><br><h3>3. Practical Exercises:</h3><ul class='custom-list'><li><b>5-Minute Breath Focus:</b> Observe your breath without controlling it.</li><li><b>Body Scan:</b> Notice every part of your body in detail.</li><li><b>Single-Tasking:</b> Do one task with full attention (no distractions).</li></ul><br><h3>4. Mastery Techniques:</h3><ul class='custom-list'><li><b>Extended Meditation:</b> Gradually increase mindful time.</li><li><b>Stoic Rehearsal:</b> Visualize worst-case scenarios calmly.</li><li><b>Mindful Action:</b> Apply awareness to daily tasks (eating, walking, talking).</li></ul><br><h3>5. Learn More:</h3><hr class='thin-hr'><b>Articles:</b><br><a href='https://www.mindful.org/getting-started-with-mindfulness/' class='custom-link'>Getting Started with Mindfulness</a><br><a href='https://www.health.harvard.edu/mind-and-mood/can-mindfulness-change-your-brain' class='custom-link'>Can Mindfulness Change Your Brain?</a><br><hr class='thin-hr'><b>YouTube:</b><br><a href='https://youtu.be/1nP5oedmzkM?si=9M-A-5WdzVPxYwc3' class='custom-link'>Self-Transformation Through Mindfulness</a><br><hr class='thin-hr'><b>Books:</b><br><a href='https://amzn.to/4bYrJKX' class='custom-link'>An Eight-Week Plan for Finding Peace in a Frantic World</a>"
                        }
                    ]
                }
            ]
        };

        
        function createComet() {
            const comet = document.createElement('div');
            comet.className = 'comet';
            
            const head = document.createElement('div');
            head.className = 'comet-head';
            
            const tail = document.createElement('div');
            tail.className = 'comet-tail';
            
            const dust = document.createElement('div');
            dust.className = 'comet-dust';
            
            comet.appendChild(head);
            comet.appendChild(tail);
            comet.appendChild(dust);
            
            document.getElementById('universe').appendChild(comet);
            
            // Create second comet with delay
            setTimeout(() => {
                const comet2 = document.createElement('div');
                comet2.className = 'comet2';
                
                const head2 = document.createElement('div');
                head2.className = 'comet-head';
                
                const tail2 = document.createElement('div');
                tail2.className = 'comet-tail';
                
                const dust2 = document.createElement('div');
                dust2.className = 'comet-dust';
                
                comet2.appendChild(head2);
                comet2.appendChild(tail2);
                comet2.appendChild(dust2);
                
                document.getElementById('universe').appendChild(comet2);
            }, 15000);
        }
        
        // Call this function after the universe is initialized
        createComet();
        


        // Initialize variables
        let points = 0;
        let visitedNodes = new Set();
        let stars = [];
        let universe;
        let universeCtx;
        let mapContainer;
        let knowledgeMap;
        let contentPanel;
        let contentPreview;
        let contentFull;
        let showMoreButton;
        let closeButton;
        let contentTitle;
        let pointsDisplay;
        let progressBar;
        let progressText;
        let navHelper;
        let totalNodes = 0;

        function loadSavedProgress() {
            // Load points
            points = parseInt(localStorage.getItem('knowledgePoints') || '0');
            pointsDisplay.textContent = `${points} points`;
            
            // Load visited nodes
            const savedNodes = JSON.parse(localStorage.getItem('visitedNodes') || '[]');
            visitedNodes = new Set(savedNodes);
            
            // Load completed quizzes
            const savedQuizzes = JSON.parse(localStorage.getItem('completedQuizzes') || '[]');
            completedQuizzes = new Set(savedQuizzes);
            
            // Count total nodes first
            totalNodes = countNodes(knowledgeStructure);
            
            // Update progress display immediately
            const visitedProgress = visitedNodes.size;
            const quizProgress = completedQuizzes.size;
            const totalProgress = visitedProgress + quizProgress;
            const maxProgress = totalNodes * 2; // Multiply by 2 since each node can be visited and have its quiz completed
            
            const progressPercentage = Math.floor((totalProgress / maxProgress) * 100);
            
            // Update DOM elements directly
            progressBar.style.width = `${progressPercentage}%`;
            progressText.textContent = `${progressPercentage}% explored`;
        }


        // Count total nodes for progress tracking
        function countNodes(node) {
            let count = 1; // Count the node itself
            if (node.children) {
                for (const child of node.children) {
                    count += countNodes(child);
                }
            }
            return count;
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Get DOM elements
            universe = document.getElementById('universe');
            universeCtx = universe.getContext('2d');
            mapContainer = document.getElementById('map-container');
            knowledgeMap = document.getElementById('knowledge-map');
            contentPanel = document.getElementById('content-panel');
            contentPreview = document.getElementById('content-preview');
            contentFull = document.getElementById('content-full');
            showMoreButton = document.getElementById('show-more-button');
            closeButton = document.getElementById('close-button');
            contentTitle = document.getElementById('content-title');
            pointsDisplay = document.getElementById('points-display');
            progressBar = document.getElementById('progress-bar');
            progressText = document.getElementById('progress-text');
            navHelper = document.getElementById('nav-helper');
            // Load saved progress before initializing
            loadSavedProgress();
            // Count total nodes and set max points
            totalNodes = countNodes(knowledgeStructure);
            config.maxPoints = totalNodes * 10;

            // Count total nodes and set max points
            totalNodes = countNodes(knowledgeStructure);
            config.maxPoints = totalNodes * 20;
            
            // Initialize the universe
            initUniverse();
            
            // Create the knowledge map
            createMap();
            
            // Set up event listeners
            setupEventListeners();
            
            // Start animations
            animate();
            
            // Initial scroll to base node
            setTimeout(() => {
                scrollToBaseNode();
            }, 500);
        });

        // Initialize the starry universe background
        function initUniverse() {
            // Set canvas dimensions
            resizeUniverse();
            
            // Create stars
            createStars();
            
            // Handle window resize
            window.addEventListener('resize', function() {
                resizeUniverse();
            });
        }

        // Resize universe canvas
        function resizeUniverse() {
            universe.width = window.innerWidth;
            universe.height = window.innerHeight;
        }

        // Create stars for the universe background
        function createStars() {
            stars = [];
            for (let i = 0; i < config.maxStars; i++) {
                stars.push({
                    x: Math.random() * universe.width,
                    y: Math.random() * universe.height,
                    size: config.starSizes.min + Math.random() * (config.starSizes.max - config.starSizes.min),
                    speed: config.starSpeed.min + Math.random() * (config.starSpeed.max - config.starSpeed.min),
                    brightness: 0.2 + Math.random() * 0.8,
                    blinking: Math.random() > 0.8,
                    blinkPhase: Math.random() * Math.PI * 2
                });
            }
        }

        // Create the knowledge map
        function createMap() {
            // Calculate base position
            const baseX = knowledgeMap.offsetWidth * config.basePosition.x;
            const baseY = knowledgeMap.offsetHeight * config.basePosition.y;
            
            // Create the base node
            createNode(knowledgeStructure, baseX, baseY, 0, 0);
        }

        // Create a node in the knowledge map
        function createNode(nodeData, x, y, level, angle) {
            // Determine node size based on level
            let size;
            let nodeClass;
            
            if (level === 0) {
                size = config.baseNodeSize;
                nodeClass = 'base-node';
            } else if (level === 1) {
                size = config.level1NodeSize;
                nodeClass = 'level-1-node';
            } else {
                size = config.level2NodeSize;
                nodeClass = 'level-2-node';
            }
            
            // Create node element
            const node = document.createElement('div');
            node.className = `node ${nodeClass}`;
            node.style.width = `${size}px`;
            node.style.height = `${size}px`;
            node.style.left = `${x - size/2}px`;
            node.style.top = `${y - size/2}px`;
            
            // Create label
            const label = document.createElement('div');
            label.className = 'node-label';
            label.textContent = nodeData.title;
            node.appendChild(label);
            
            // Store node data
            node.dataset.title = nodeData.title;
            node.dataset.description = nodeData.description;
            node.dataset.content = nodeData.content;
            node.dataset.level = level;
            
            // Add node to the map
            knowledgeMap.appendChild(node);
            
            // Create child nodes if any
            if (nodeData.children && nodeData.children.length > 0) {
                const spacing = level === 0 ? config.nodeSpacing.level1 : config.nodeSpacing.level2;
                const angleStep = (Math.PI * 2) / nodeData.children.length;
                let startAngle = level === 0 ? -Math.PI / 2 : angle - (Math.PI / 3);
                
                // Adjust start angle based on level
                if (level === 0) {
                    startAngle = -Math.PI / 2; // Start from top
                } else if (level === 1) {
                    // Adjust angle to spread children in 120-degree arc
                    startAngle = angle - Math.PI / 3;
                }
                
                // Create children
                for (let i = 0; i < nodeData.children.length; i++) {
                    const childAngle = startAngle + (i * angleStep);
                    const childX = x + Math.cos(childAngle) * spacing;
                    const childY = y + Math.sin(childAngle) * spacing;
                    
                    // Create line connection
                    createLine(x, y, childX, childY);
                    
                    // Create child node
                    createNode(nodeData.children[i], childX, childY, level + 1, childAngle);
                }
            }
        }

        // Create a line connecting nodes
        function createLine(x1, y1, x2, y2) {
            const dx = x2 - x1;
            const dy = y2 - y1;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx);
            
            const line = document.createElement('div');
            line.className = 'line';
            line.style.width = `${distance}px`;
            line.style.height = `${config.lineWidth}px`;
            line.style.left = `${x1}px`;
            line.style.top = `${y1}px`;
            line.style.transform = `rotate(${angle}rad)`;
            
            knowledgeMap.appendChild(line);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Node click event
            knowledgeMap.addEventListener('click', function(event) {
                const node = event.target.closest('.node');
                if (node) {
                    openNodeContent(node);
                }
            });
            
            // Close button event
            closeButton.addEventListener('click', function() {
                closeContent();
            });
            
            // Show more button event
            showMoreButton.addEventListener('click', function() {
                showFullContent();
            });
            
            // Nav helper event
            navHelper.addEventListener('click', function() {
                scrollToBaseNode();
            });
        }

        // Add to the openNodeContent function to show quiz option
        function openNodeContent(node) {
            // Check if node has been visited
            const nodeId = node.dataset.title;
            if (!visitedNodes.has(nodeId)) {
                visitedNodes.add(nodeId);
                updateProgress();
                saveProgress();
            }
            
            // Set content
            contentTitle.textContent = node.dataset.title;
            contentPreview.textContent = node.dataset.description;
            
            // Get the node data from the knowledge structure
            const nodeData = findNodeData(knowledgeStructure, node.dataset.title);
            
            contentFull.innerHTML = `
                <p>${node.dataset.content}</p>
                <div class="quiz-container">
                    <h3>Knowledge Quiz</h3>
                    <p>Test your understanding and earn points!</p>
                    <button class="start-quiz-button" id="start-quiz-button">Start Quiz</button>
                </div>
            `;
            
            // Store the node data for quiz access
            contentFull.dataset.nodeTitle = node.dataset.title;
            
            // Show preview, hide full content
            contentPreview.style.display = 'block';
            contentFull.style.display = 'none';
            showMoreButton.style.display = 'block';
            
            // Show the panel with compact height
            contentPanel.style.display = 'flex';
            contentPanel.style.height = '40%'; // Make it shorter initially
            contentPanel.style.top = '60%'; // Position from bottom
            contentPanel.style.transform = 'translate(-50%, -50%)'; // Adjust transform for bottom positioning
            contentPanel.classList.remove('expanded');
            
            // Add highlight effect to the node
            const allNodes = document.querySelectorAll('.node');
            allNodes.forEach(n => n.style.opacity = '0.5');
            node.style.opacity = '1';
            node.style.transform = 'scale(1.2)';
            node.style.boxShadow = '0 0 30px rgba(255, 255, 255, 0.7)';
            
            // Highlight connected lines
            highlightConnectedLines(node);

            // Don't fully dim the map yet
            document.getElementById('map-container').classList.remove('dimmed');
        }

        // Find node data in the knowledge structure by title
        function findNodeData(structure, title) {
            if (structure.title === title) {
                return structure;
            }
            
            if (structure.children) {
                for (const child of structure.children) {
                    const found = findNodeData(child, title);
                    if (found) return found;
                }
            }
            
            return null;
        }

        // Highlight lines connected to the active node
        function highlightConnectedLines(node) {
            const nodeRect = node.getBoundingClientRect();
            const mapRect = knowledgeMap.getBoundingClientRect();
            
            const nodeCenterX = parseInt(node.style.left) + parseInt(node.style.width) / 2;
            const nodeCenterY = parseInt(node.style.top) + parseInt(node.style.height) / 2;
            
            const lines = document.querySelectorAll('.line');
            lines.forEach(line => {
                line.classList.remove('pulse');
                line.style.opacity = '0.2';
                
                const lineX = parseInt(line.style.left);
                const lineY = parseInt(line.style.top);
                const lineLength = parseInt(line.style.width);
                const lineAngle = parseFloat(line.style.transform.replace('rotate(', '').replace('rad)', ''));
                
                const lineEndX = lineX + Math.cos(lineAngle) * lineLength;
                const lineEndY = lineY + Math.sin(lineAngle) * lineLength;
                
                // Check if line starts or ends at node center (with tolerance)
                const tolerance = 40;
                const isConnected = 
                    (Math.abs(lineX - nodeCenterX) < tolerance && Math.abs(lineY - nodeCenterY) < tolerance) ||
                    (Math.abs(lineEndX - nodeCenterX) < tolerance && Math.abs(lineEndY - nodeCenterY) < tolerance);
                
                if (isConnected) {
                    line.style.opacity = '0.8';
                    line.style.backgroundColor = 'rgba(255, 255, 255, 0.8)';
                    line.classList.add('pulse');
                }
            });
        }

        // Show full content - modified to expand panel to full screen
        function showFullContent() {
            contentPreview.style.display = 'none';
            contentFull.style.display = 'block';
            showMoreButton.style.display = 'none';
            
            // Expand panel to full screen
            contentPanel.style.height = '100%';
            contentPanel.style.width = '100%';
            contentPanel.style.maxWidth = '100%';
            contentPanel.style.maxHeight = '100%';
            contentPanel.style.top = '50%';
            contentPanel.style.transform = 'translate(-50%, -50%)';
            contentPanel.classList.add('expanded');
            
            // Fully dim the map
            document.getElementById('map-container').classList.add('dimmed');
            
            // Award points for exploring deeper
            addPoints(5);
        }

        // Close content panel - restore original size when closing
        function closeContent() {
            contentPanel.style.display = 'none';
            contentPanel.style.height = '40%'; // Reset height
            contentPanel.style.width = '80%'; // Reset width
            contentPanel.style.maxWidth = '600px'; // Reset max width
            contentPanel.style.top = '60%'; // Reset position
            contentPanel.style.transform = 'translate(-50%, 0)'; // Reset transform
            contentPanel.classList.remove('expanded');
            
            // Remove dimming from map
            document.getElementById('map-container').classList.remove('dimmed');
            
            // Remove highlight effects
            const allNodes = document.querySelectorAll('.node');
            allNodes.forEach(n => {
                n.style.opacity = '1';
                n.style.transform = '';
                n.style.boxShadow = '';
            });
            
            const lines = document.querySelectorAll('.line');
            lines.forEach(line => {
                line.classList.remove('pulse');
                line.style.opacity = '0.3';
                line.style.backgroundColor = 'rgba(255, 255, 255, 0.3)';
            });
        }

        // Update the addPoints function to show animation
        function addPoints(value) {
            points += value;
            pointsDisplay.textContent = `${points} points`;
            
            // Show animation for points
            pointsDisplay.style.transform = 'scale(1.2)';
            setTimeout(() => {
                pointsDisplay.style.transform = 'scale(1)';
            }, 300);
            
            // Show floating animation
            if (value > 0) {
                const pointsAnim = document.createElement('div');
                pointsAnim.className = 'points-animation';
                pointsAnim.textContent = `+${value} points`;
                pointsAnim.style.left = `${Math.random() * 80 + 10}%`;
                pointsAnim.style.top = `${Math.random() * 30 + 50}%`;
                document.body.appendChild(pointsAnim);
                
                // Remove element after animation
                setTimeout(() => {
                    document.body.removeChild(pointsAnim);
                }, 1500);
            }
            // Save progress
            saveProgress();
        }

        function updateProgress() {
            // Calculate progress based on visited nodes
            const visitedProgress = visitedNodes.size;
            const quizProgress = completedQuizzes.size;
            
            // Total progress is the sum of visited nodes and completed quizzes
            const totalProgress = visitedProgress + quizProgress;
            const maxProgress = totalNodes * 2; // Multiply by 2 since each node can be visited and have its quiz completed
            
            const progressPercentage = Math.floor((totalProgress / maxProgress) * 100);
            
            progressBar.style.width = `${progressPercentage}%`;
            progressText.textContent = `${progressPercentage}% explored`;
        }



        function saveProgress() {
            // Save points
            localStorage.setItem('knowledgePoints', points.toString());
            
            // Save visited nodes as array
            localStorage.setItem('visitedNodes', JSON.stringify([...visitedNodes]));
            
            // Save completed quizzes as array
            localStorage.setItem('completedQuizzes', JSON.stringify([...completedQuizzes]));
            
            // Update progress display
            updateProgress();
        }


        // Call to add styles on load
        document.addEventListener('DOMContentLoaded', function() {
            addQuizStyles();
            // Rest of the existing code...
        });

        // Scroll to base node
        function scrollToBaseNode() {
            const baseNode = document.querySelector('.base-node');
            if (baseNode) {
                const baseRect = baseNode.getBoundingClientRect();
                const mapRect = mapContainer.getBoundingClientRect();
                
                const scrollX = parseInt(baseNode.style.left) + parseInt(baseNode.style.width) / 2 - mapRect.width / 2;
                const scrollY = parseInt(baseNode.style.top) + parseInt(baseNode.style.height) / 2 - mapRect.height / 2;
                
                mapContainer.scrollTo({
                    left: scrollX,
                    top: scrollY,
                    behavior: 'smooth'
                });
            }
        }

        // Function to show node content after quiz
        function showNodeContent(nodeTitle) {
            const nodeData = findNodeData(knowledgeStructure, nodeTitle);
            
            contentFull.innerHTML = `
                <p>${nodeData.content}</p>
                <div class="quiz-container">
                    <h3>Knowledge Quiz</h3>
                    <p>You've completed this quiz!</p>
                    <button class="retake-quiz-button" id="retake-quiz-button">Retake Quiz</button>
                </div>
            `;
            
            // Add event listener to retake button
            document.getElementById('retake-quiz-button').addEventListener('click', function() {
                startQuiz(nodeTitle);
            });
        }

        // Function to submit and grade quiz
        function submitQuiz(quiz, nodeTitle) {
            let correctAnswers = 0;
            let totalQuestions = quiz.length;
            
            // Check each question
            quiz.forEach((q, index) => {
                const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
                const questionElement = document.getElementById(`question-${index}`);
                
                if (selectedOption) {
                    const selectedValue = parseInt(selectedOption.value);
                    
                    if (selectedValue === q.correctAnswer) {
                        correctAnswers++;
                        questionElement.classList.add('correct-answer');
                    } else {
                        questionElement.classList.add('wrong-answer');
                    }
                } else {
                    questionElement.classList.add('unanswered');
                }
            });
            
            // Calculate points - 10 points per correct answer
            const earnedPoints = correctAnswers * 10;
            
            // Check if quiz was already completed
            const quizKey = `quiz_${nodeTitle}`;
            if (!completedQuizzes.has(quizKey)) {
                addPoints(earnedPoints);
                completedQuizzes.add(quizKey);
                saveProgress();
            }
            
            // Show results
            const resultsContainer = document.createElement('div');
            resultsContainer.className = 'quiz-results';
            
            resultsContainer.innerHTML = `
                <h3>Quiz Results</h3>
                <p>You answered ${correctAnswers} out of ${totalQuestions} questions correctly.</p>
                <p>Points earned: ${earnedPoints}</p>
                ${completedQuizzes.has(quizKey) ? '<p>You\'ve already completed this quiz before. No additional points awarded.</p>' : ''}
                <button class="close-quiz-button" id="close-quiz-button">Continue Learning</button>
            `;
            
            contentFull.appendChild(resultsContainer);
            
            // Add event listener to close button
            document.getElementById('close-quiz-button').addEventListener('click', function() {
                // Show the original content
                showNodeContent(nodeTitle);
            });
        }

        // Function to start the quiz
        function startQuiz(nodeTitle) {
            const nodeData = findNodeData(knowledgeStructure, nodeTitle);
            
            if (!nodeData || !nodeData.quiz) {
                contentFull.innerHTML += '<p>No quiz available for this topic yet.</p>';
                return;
            }
            
            const quiz = nodeData.quiz;
            const quizContainer = document.createElement('div');
            quizContainer.className = 'quiz-questions';
            
            let quizHTML = '<h3>Knowledge Quiz</h3>';
            
            quiz.forEach((q, index) => {
                quizHTML += `
                    <div class="quiz-question" id="question-${index}">
                        <p class="question-text">${q.question}</p>
                        <div class="options-container">
                `;
                
                q.options.forEach((option, optIndex) => {
                    quizHTML += `
                        <div class="option">
                            <input type="radio" id="q${index}-opt${optIndex}" name="q${index}" value="${optIndex}">
                            <label for="q${index}-opt${optIndex}">${option}</label>
                        </div>
                    `;
                });
                
                quizHTML += `
                        </div>
                    </div>
                `;
            });
            
            quizHTML += `
                <div class="quiz-controls">
                    <button class="submit-quiz-button" id="submit-quiz-button">Submit Answers</button>
                </div>
            `;
            
            quizContainer.innerHTML = quizHTML;
            
            // Replace content with quiz
            contentFull.innerHTML = '';
            contentFull.appendChild(quizContainer);
            
            // Add event listener to submit button
            document.getElementById('submit-quiz-button').addEventListener('click', function() {
                submitQuiz(quiz, nodeTitle);
            });
        }

        // Animation loop
        function animate() {
            // Clear canvas
            universeCtx.clearRect(0, 0, universe.width, universe.height);
            
            // Draw and update stars
            drawStars();
            
            // Request next frame
            requestAnimationFrame(animate);
        }

        // Draw stars
        function drawStars() {
            for (let i = 0; i < stars.length; i++) {
                const star = stars[i];
                
                // Update star position
                star.y += star.speed;
                if (star.y > universe.height) {
                    star.y = 0;
                    star.x = Math.random() * universe.width;
                }
                
                // Calculate brightness
                let brightness = star.brightness;
                if (star.blinking) {
                    star.blinkPhase += 0.02;
                    brightness *= (0.5 + 0.5 * Math.sin(star.blinkPhase));
                }
                
                // Draw star
                universeCtx.fillStyle = `rgba(255, 255, 255, ${brightness})`;
                universeCtx.beginPath();
                universeCtx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                universeCtx.fill();
                
                // Add glow effect for brighter stars
                if (star.size > 2) {
                    universeCtx.globalAlpha = 0.2 * brightness;
                    universeCtx.beginPath();
                    universeCtx.arc(star.x, star.y, star.size * 2, 0, Math.PI * 2);
                    universeCtx.fill();
                    universeCtx.globalAlpha = 1.0;
                }
            }
        }

        // Add constellation-like patterns in the background
        function drawConstellations() {
            universeCtx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            universeCtx.lineWidth = 0.5;
            
            // Select random stars to form constellations
            for (let i = 0; i < 5; i++) {
                const constellationSize = 3 + Math.floor(Math.random() * 4);
                const constellationStars = [];
                
                // Select random stars
                for (let j = 0; j < constellationSize; j++) {
                    const starIndex = Math.floor(Math.random() * stars.length);
                    constellationStars.push(stars[starIndex]);
                }
                
                // Draw lines between stars
                universeCtx.beginPath();
                universeCtx.moveTo(constellationStars[0].x, constellationStars[0].y);
                for (let j = 1; j < constellationStars.length; j++) {
                    universeCtx.lineTo(constellationStars[j].x, constellationStars[j].y);
                }
                universeCtx.stroke();
            }
        }

        // Mobile touch support
        function setupTouchSupport() {
            let touchStartX = 0;
            let touchStartY = 0;
            let touchMoved = false;
            
            mapContainer.addEventListener('touchstart', function(e) {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                touchMoved = false;
            });
            
            mapContainer.addEventListener('touchmove', function(e) {
                if (e.touches.length > 0) {
                    const deltaX = touchStartX - e.touches[0].clientX;
                    const deltaY = touchStartY - e.touches[0].clientY;
                    
                    if (Math.abs(deltaX) > 10 || Math.abs(deltaY) > 10) {
                        touchMoved = true;
                    }
                }
            });
            
            mapContainer.addEventListener('touchend', function(e) {
                if (!touchMoved) {
                    // Simulate click if touch didn't move much
                    const touch = e.changedTouches[0];
                    const element = document.elementFromPoint(touch.clientX, touch.clientY);
                    
                    const node = element.closest('.node');
                    if (node) {
                        openNodeContent(node);
                    }
                }
            });
        }

        // Add to event listeners
        function setupEventListeners() {
            // Node click event
            knowledgeMap.addEventListener('click', function(event) {
                const node = event.target.closest('.node');
                if (node) {
                    openNodeContent(node);
                }
            });
            
            // Close button event
            closeButton.addEventListener('click', function() {
                closeContent();
            });
            
            // Show more button event
            showMoreButton.addEventListener('click', function() {
                showFullContent();
            });
            
            // Nav helper event
            navHelper.addEventListener('click', function() {
                scrollToBaseNode();
            });
            
            // Event delegation for quiz buttons
            contentPanel.addEventListener('click', function(event) {
                if (event.target.id === 'start-quiz-button') {
                    const nodeTitle = contentFull.dataset.nodeTitle;
                    startQuiz(nodeTitle);
                }
            });
        }

        // Additional variables needed for quiz system
        let completedQuizzes = new Set(JSON.parse(localStorage.getItem('completedQuizzes') || '[]'));

        // Modify the existing functions
        function showFullContent() {
            contentPreview.style.display = 'none';
            contentFull.style.display = 'block';
            showMoreButton.style.display = 'none';
            
            // Expand panel to full screen
            contentPanel.style.height = '100%';
            contentPanel.style.width = '100%';
            contentPanel.style.maxWidth = '100%';
            contentPanel.style.maxHeight = '100%';
            contentPanel.style.top = '50%';
            contentPanel.style.transform = 'translate(-50%, -50%)';
            contentPanel.classList.add('expanded');
            
            // Fully dim the map
            document.getElementById('map-container').classList.add('dimmed');
        }

        // Document ready function changes
        document.addEventListener('DOMContentLoaded', function() {
            // Get DOM elements
            universe = document.getElementById('universe');
            universeCtx = universe.getContext('2d');
            mapContainer = document.getElementById('map-container');
            knowledgeMap = document.getElementById('knowledge-map');
            contentPanel = document.getElementById('content-panel');
            contentPreview = document.getElementById('content-preview');
            contentFull = document.getElementById('content-full');
            showMoreButton = document.getElementById('show-more-button');
            closeButton = document.getElementById('close-button');
            contentTitle = document.getElementById('content-title');
            pointsDisplay = document.getElementById('points-display');
            progressBar = document.getElementById('progress-bar');
            progressText = document.getElementById('progress-text');
            navHelper = document.getElementById('nav-helper');
            // Update display with saved values
            pointsDisplay.textContent = `${points} points`;
            // Now load saved progress
            loadSavedProgress();
            // Add quizzes to knowledge structure
            knowledgeStructure = addQuizzesToKnowledgeStructure(knowledgeStructure);
            
            // Count total nodes and set max points
            totalNodes = countNodes(knowledgeStructure);
            config.maxPoints = totalNodes * 20; // Increase max points for quizzes

            // Update progress display
            updateProgress();
            
            // Initialize the universe
            initUniverse();
            
            // Create the knowledge map
            createMap();
            
            // Set up event listeners
            setupEventListeners();
            
            // Start animations
            animate();
            
            // Initial scroll to base node
            setTimeout(() => {
                scrollToBaseNode();
            }, 500);
        });

        // Add CSS styles
        function addQuizStyles() {
            const styleSheet = document.createElement("style");
            styleSheet.innerText = `
                @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap');
                
                :root {
                    --primary-glow: conic-gradient(
                        from 180deg at 50% 50%,
                        #4a90e2 0deg,
                        #63b3ed 55deg,
                        #805ad5 120deg,
                        #d53f8c 160deg,
                        #ed64a6 210deg,
                        #4a90e2 360deg
                    );
                    --secondary-glow: radial-gradient(
                        rgba(255, 255, 255, 0.1),
                        rgba(255, 255, 255, 0)
                    );
                    --correct-color: #10B981;
                    --wrong-color: #EF4444;
                    --warning-color: #F59E0B;
                    --quiz-bg: #0F172A;
                    --card-bg: rgba(30, 41, 59, 0.8);
                    --hover-bg: rgba(51, 65, 85, 0.5);
                }
                
                .quiz-container {
                    margin: 50px auto;
                    padding: 0;
                    max-width: 850px;
                    font-family: 'Poppins', sans-serif;
                    position: relative;
                    border-radius: 24px;
                    overflow: hidden;
                    background: var(--quiz-bg);
                    box-shadow: 
                        0 0 60px rgba(74, 144, 226, 0.2),
                        0 0 120px rgba(74, 144, 226, 0.1),
                        0 20px 40px rgba(0, 0, 0, 0.4);
                    transform-style: preserve-3d;
                    perspective: 1000px;
                }
                
                .quiz-container::before {
                    content: '';
                    position: absolute;
                    inset: -10px;
                    background: var(--primary-glow);
                    filter: blur(30px);
                    opacity: 0.15;
                    z-index: -1;
                    animation: glow-pulse 8s ease-in-out infinite alternate;
                }
                
                .quiz-container::after {
                    content: '';
                    position: absolute;
                    inset: 0;
                    padding: 2px;
                    border-radius: 24px;
                    background: linear-gradient(
                        135deg, 
                        rgba(74, 144, 226, 0.5) 0%, 
                        rgba(128, 90, 213, 0.2) 25%, 
                        transparent 50%,
                        rgba(237, 100, 166, 0.2) 75%,
                        rgba(74, 144, 226, 0.5) 100%
                    );
                    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
                    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
                    mask-composite: exclude;
                    -webkit-mask-composite: xor;
                    pointer-events: none;
                }
                
                @keyframes glow-pulse {
                    0% { opacity: 0.1; filter: blur(30px); }
                    50% { opacity: 0.2; filter: blur(40px); }
                    100% { opacity: 0.15; filter: blur(30px); }
                }
                
                .quiz-header {
                    padding: 30px;
                    background: rgba(15, 23, 42, 0.9);
                    position: relative;
                    overflow: hidden;
                    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                }
                
                .quiz-header h2 {
                    font-family: 'Montserrat', sans-serif;
                    font-weight: 700;
                    font-size: 28px;
                    color: white;
                    margin: 0;
                    position: relative;
                    z-index: 1;
                    text-shadow: 0 2px 10px rgba(74, 144, 226, 0.3);
                    letter-spacing: -0.5px;
                }
                
                .quiz-header::before {
                    content: '';
                    position: absolute;
                    width: 200px;
                    height: 200px;
                    background: var(--primary-glow);
                    filter: blur(80px);
                    opacity: 0.1;
                    top: -100px;
                    right: -50px;
                    border-radius: 50%;
                    animation: float 15s ease-in-out infinite;
                }
                
                @keyframes float {
                    0%, 100% { transform: translateY(0) scale(1); }
                    50% { transform: translateY(-20px) scale(1.1); }
                }
                
                .start-quiz-button, .submit-quiz-button, .close-quiz-button, .retake-quiz-button {
                    background: rgba(74, 144, 226, 0.1);
                    color: white;
                    border: none;
                    padding: 16px 36px;
                    border-radius: 16px;
                    font-family: 'Montserrat', sans-serif;
                    font-size: 16px;
                    font-weight: 600;
                    cursor: pointer;
                    margin: 25px 0;
                    position: relative;
                    overflow: hidden;
                    transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
                    backdrop-filter: blur(5px);
                    letter-spacing: 0.5px;
                    text-transform: uppercase;
                    z-index: 1;
                    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
                }
                
                .start-quiz-button::before, .submit-quiz-button::before, 
                .close-quiz-button::before, .retake-quiz-button::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(
                        135deg,
                        #4a90e2 0%,
                        #805ad5 50%,
                        #d53f8c 100%
                    );
                    opacity: 0;
                    z-index: -1;
                    transition: opacity 0.4s ease;
                }
                
                .start-quiz-button::after, .submit-quiz-button::after, 
                .close-quiz-button::after, .retake-quiz-button::after {
                    content: '';
                    position: absolute;
                    top: -2px;
                    left: -2px;
                    right: -2px;
                    bottom: -2px;
                    background: linear-gradient(
                        135deg,
                        #4a90e2 0%,
                        #805ad5 50%,
                        #d53f8c 100%
                    );
                    border-radius: 16px;
                    z-index: -2;
                }
                
                .start-quiz-button:hover, .submit-quiz-button:hover, 
                .close-quiz-button:hover, .retake-quiz-button:hover {
                    transform: translateY(-3px) scale(1.02);
                    box-shadow: 
                        0 15px 30px rgba(0, 0, 0, 0.3),
                        0 0 20px rgba(74, 144, 226, 0.3);
                    text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
                }
                
                .start-quiz-button:hover::before, .submit-quiz-button:hover::before, 
                .close-quiz-button:hover::before, .retake-quiz-button:hover::before {
                    opacity: 1;
                }
                
                .start-quiz-button:active, .submit-quiz-button:active, 
                .close-quiz-button:active, .retake-quiz-button:active {
                    transform: translateY(1px) scale(0.98);
                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                }
                
                .quiz-questions {
                    padding: 30px;
                    display: flex;
                    flex-direction: column;
                    gap: 40px;
                    position: relative;
                    z-index: 1;
                }
                
                .quiz-questions::before {
                    content: '';
                    position: absolute;
                    width: 300px;
                    height: 300px;
                    background: var(--secondary-glow);
                    border-radius: 50%;
                    top: 20%;
                    left: -150px;
                    opacity: 0.1;
                    filter: blur(60px);
                    animation: float-slow 20s ease-in-out infinite alternate;
                }
                
                @keyframes float-slow {
                    0%, 100% { transform: translate(0, 0); }
                    50% { transform: translate(50px, 50px); }
                }
                
                .quiz-question {
                    margin-bottom: 30px;
                    padding: 0;
                    background: transparent;
                    position: relative;
                    transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
                    transform: translateZ(0);
                    transform-style: preserve-3d;
                }
                
                .quiz-question-inner {
                    padding: 30px;
                    background: var(--card-bg);
                    border-radius: 20px;
                    position: relative;
                    overflow: hidden;
                    backdrop-filter: blur(10px);
                    box-shadow: 
                        0 10px 30px rgba(0, 0, 0, 0.2),
                        0 1px 3px rgba(0, 0, 0, 0.1),
                        inset 0 1px 1px rgba(255, 255, 255, 0.05);
                    transition: all 0.3s ease;
                    border: 1px solid rgba(255, 255, 255, 0.05);
                }
                
                .quiz-question:hover .quiz-question-inner {
                    transform: translateY(-5px);
                    box-shadow: 
                        0 15px 40px rgba(0, 0, 0, 0.3),
                        0 1px 3px rgba(0, 0, 0, 0.1),
                        inset 0 1px 1px rgba(255, 255, 255, 0.05);
                }
                
                .quiz-question::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(
                        135deg,
                        rgba(74, 144, 226, 0.1) 0%,
                        rgba(128, 90, 213, 0.1) 50%,
                        rgba(213, 63, 140, 0.1) 100%
                    );
                    border-radius: 20px;
                    z-index: -1;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                }
                
                .quiz-question:hover::before {
                    opacity: 1;
                }
                
                .question-number {
                    position: absolute;
                    top: -15px;
                    left: 20px;
                    background: linear-gradient(135deg, #4a90e2, #805ad5);
                    color: white;
                    font-size: 14px;
                    font-weight: 600;
                    padding: 5px 15px;
                    border-radius: 20px;
                    box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
                    z-index: 2;
                }
                
                .question-text {
                    font-weight: 600;
                    margin-bottom: 25px;
                    font-size: 20px;
                    color: rgba(255, 255, 255, 0.95);
                    line-height: 1.6;
                    position: relative;
                    padding-left: 20px;
                    font-family: 'Montserrat', sans-serif;
                }
                
                .question-text::before {
                    content: '';
                    position: absolute;
                    left: 0;
                    top: 5px;
                    bottom: 5px;
                    width: 4px;
                    background: linear-gradient(to bottom, #4a90e2, #805ad5);
                    border-radius: 4px;
                }
                
                .options-container {
                    display: flex;
                    flex-direction: column;
                    gap: 16px;
                    padding-left: 10px;
                    position: relative;
                    z-index: 1;
                }
                
                .option {
                    display: flex;
                    align-items: center;
                    gap: 16px;
                    padding: 0;
                    border-radius: 16px;
                    background: transparent;
                    transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
                    position: relative;
                    overflow: hidden;
                }
                
                .option-inner {
                    display: flex;
                    align-items: center;
                    gap: 16px;
                    padding: 16px 20px;
                    border-radius: 16px;
                    background: rgba(30, 41, 59, 0.5);
                    width: 100%;
                    transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
                    border: 1px solid rgba(255, 255, 255, 0.05);
                    position: relative;
                    overflow: hidden;
                    backdrop-filter: blur(5px);
                }
                
                .option:hover .option-inner {
                    background: var(--hover-bg);
                    border-color: rgba(255, 255, 255, 0.1);
                    transform: translateX(5px);
                }
                
                .option::before {
                    content: '';
                    position: absolute;
                    inset: 0;
                    background: linear-gradient(90deg, 
                        rgba(74, 144, 226, 0.1), 
                        rgba(128, 90, 213, 0.1)
                    );
                    border-radius: 16px;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                }
                
                .option:hover::before {
                    opacity: 1;
                }
                
                .option-inner::after {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(
                        90deg,
                        rgba(255, 255, 255, 0) 0%,
                        rgba(255, 255, 255, 0.05) 50%,
                        rgba(255, 255, 255, 0) 100%
                    );
                    transform: translateX(-100%);
                    transition: transform 0.6s ease;
                }
                
                .option:hover .option-inner::after {
                    transform: translateX(100%);
                }
                
                .option input[type="radio"] {
                    appearance: none;
                    -webkit-appearance: none;
                    width: 24px;
                    height: 24px;
                    border-radius: 50%;
                    border: 2px solid rgba(255, 255, 255, 0.2);
                    background: rgba(30, 41, 59, 0.5);
                    position: relative;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    flex-shrink: 0;
                }
                
                .option input[type="radio"]:checked {
                    border-color: #4a90e2;
                    background: rgba(74, 144, 226, 0.1);
                    box-shadow: 0 0 15px rgba(74, 144, 226, 0.3);
                }
                
                .option input[type="radio"]::before {
                    content: '';
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%) scale(0);
                    width: 12px;
                    height: 12px;
                    border-radius: 50%;
                    background: #4a90e2;
                    transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
                }
                
                .option input[type="radio"]:checked::before {
                    transform: translate(-50%, -50%) scale(1);
                }
                
                .option label {
                    cursor: pointer;
                    flex-grow: 1;
                    font-size: 17px;
                    line-height: 1.6;
                    color: rgba(255, 255, 255, 0.9);
                    font-weight: 400;
                    transition: color 0.3s ease;
                    padding: 5px 0;
                }
                
                .option:hover label {
                    color: rgba(255, 255, 255, 1);
                }
                
                .quiz-controls {
                    margin-top: 40px;
                    text-align: center;
                    padding: 20px;
                    position: relative;
                    z-index: 1;
                }
                
                .quiz-results {
                    margin: 40px auto;
                    padding: 0;
                    max-width: 850px;
                    position: relative;
                    border-radius: 24px;
                    overflow: hidden;
                    background: var(--quiz-bg);
                    box-shadow: 
                        0 0 60px rgba(74, 144, 226, 0.2),
                        0 0 120px rgba(74, 144, 226, 0.1),
                        0 20px 40px rgba(0, 0, 0, 0.4);
                    animation: results-appear 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
                    transform-style: preserve-3d;
                }
                
                .quiz-results::before {
                    content: '';
                    position: absolute;
                    inset: -10px;
                    background: var(--primary-glow);
                    filter: blur(30px);
                    opacity: 0.15;
                    z-index: -1;
                    animation: glow-pulse 8s ease-in-out infinite alternate;
                }
                
                .quiz-results::after {
                    content: '';
                    position: absolute;
                    inset: 0;
                    padding: 2px;
                    border-radius: 24px;
                    background: linear-gradient(
                        135deg, 
                        rgba(74, 144, 226, 0.5) 0%, 
                        rgba(128, 90, 213, 0.2) 25%, 
                        transparent 50%,
                        rgba(237, 100, 166, 0.2) 75%,
                        rgba(74, 144, 226, 0.5) 100%
                    );
                    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
                    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
                    mask-composite: exclude;
                    -webkit-mask-composite: xor;
                    pointer-events: none;
                }
                
                .results-inner {
                    padding: 40px;
                    position: relative;
                    z-index: 1;
                }
                
                @keyframes results-appear {
                    0% { opacity: 0; transform: translateY(50px) scale(0.95); }
                    100% { opacity: 1; transform: translateY(0) scale(1); }
                }
                
                .quiz-results h3 {
                    font-size: 32px;
                    margin-bottom: 25px;
                    color: white;
                    font-weight: 700;
                    text-shadow: 0 2px 10px rgba(74, 144, 226, 0.3);
                    position: relative;
                    display: inline-block;
                    font-family: 'Montserrat', sans-serif;
                }
                
                .quiz-results h3::after {
                    content: '';
                    position: absolute;
                    bottom: -10px;
                    left: 0;
                    width: 100%;
                    height: 3px;
                    background: linear-gradient(to right, #4a90e2, #805ad5, #d53f8c);
                    border-radius: 3px;
                }
                
                .quiz-results p {
                    font-size: 20px;
                    margin-bottom: 20px;
                    color: rgba(255, 255, 255, 0.9);
                    line-height: 1.7;
                    position: relative;
                }
                
                .score-container {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    margin: 30px 0;
                    position: relative;
                }
                
                .score-circle {
                    width: 180px;
                    height: 180px;
                    border-radius: 50%;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    position: relative;
                    background: rgba(30, 41, 59, 0.5);
                    box-shadow: 
                        0 10px 30px rgba(0, 0, 0, 0.2),
                        inset 0 2px 3px rgba(255, 255, 255, 0.05);
                    backdrop-filter: blur(5px);
                }
                
                .score-circle::before {
                    content: '';
                    position: absolute;
                    inset: -3px;
                    border-radius: 50%;
                    background: conic-gradient(
                        from 0deg,
                        #4a90e2 0%,
                        #805ad5 25%,
                        #d53f8c 50%,
                        #ed64a6 75%,
                        #4a90e2 100%
                    );
                    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
                    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
                    mask-composite: exclude;
                    -webkit-mask-composite: xor;
                    animation: rotate 10s linear infinite;
                }
                
                @keyframes rotate {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
                
                .score-text {
                    font-size: 48px;
                    font-weight: 700;
                    color: white;
                    text-shadow: 0 0 20px rgba(74, 144, 226, 0.5);
                    position: relative;
                    font-family: 'Montserrat', sans-serif;
                }
                
                .score-text::after {
                    content: '%';
                    font-size: 24px;
                    position: absolute;
                    top: 10px;
                    right: -20px;
                    color: rgba(255, 255, 255, 0.7);
                }
                
                .correct-answer {
                    border-left: none;
                    background: transparent;
                    position: relative;
                }
                
                .correct-answer .option-inner {
                    background: rgba(16, 185, 129, 0.1);
                    border: 1px solid rgba(16, 185, 129, 0.3);
                    box-shadow: 0 0 20px rgba(16, 185, 129, 0.1);
                }
                
                .correct-answer::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 4px;
                    height: 100%;
                    background: var(--correct-color);
                    border-radius: 4px 0 0 4px;
                }
                
                .correct-answer::after {
                    content: "✓";
                    position: absolute;
                    top: 50%;
                    right: 20px;
                    transform: translateY(-50%);
                    color: var(--correct-color);
                    font-size: 24px;
                    font-weight: bold;
                    text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
                    z-index: 2;
                }
                
                .wrong-answer {
                    border-left: none;
                    background: transparent;
                    position: relative;
                }
                
                .wrong-answer .option-inner {
                    background: rgba(239, 68, 68, 0.1);
                    border: 1px solid rgba(239, 68, 68, 0.3);
                    box-shadow: 0 0 20px rgba(239, 68, 68, 0.1);
                }
                
                .wrong-answer::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 4px;
                    height: 100%;
                    background: var(--wrong-color);
                    border-radius: 4px 0 0 4px;
                }
                
                .wrong-answer::after {
                    content: "✗";
                    position: absolute;
                    top: 50%;
                    right: 20px;
                    transform: translateY(-50%);
                    color: var(--wrong-color);
                    font-size: 24px;
                    font-weight: bold;
                    text-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
                    z-index: 2;
                }
                
                .unanswered {
                    border-left: none;
                    background: transparent;
                    position: relative;
                }
                
                .unanswered .option-inner {
                    background: rgba(245, 158, 11, 0.1);
                    border: 1px solid rgba(245, 158, 11, 0.3);
                    box-shadow: 0 0 20px rgba(245, 158, 11, 0.1);
                }
                
                .unanswered::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 4px;
                    height: 100%;
                    background: var(--warning-color);
                    border-radius: 4px 0 0 4px;
                }
                
                .unanswered::after {
                    content: "!";
                    position: absolute;
                    top: 50%;
                    right: 20px;
                    transform: translateY(-50%);
                    color: var(--warning-color);
                    font-size: 24px;
                    font-weight: bold;
                    text-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
                    z-index: 2;
                }
                
                .points-animation {
                    position: absolute;
                    color: var(--correct-color);
                    font-weight: bold;
                    font-size: 24px;
                    pointer-events: none;
                    animation: 
                        float-up 2s cubic-bezier(0.2, 0.8, 0.2, 1) forwards, 
                        fade-out 2s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
                    text-shadow: 
                        0 0 15px rgba(16, 185, 129, 0.5),
                        0 0 30px rgba(16, 185, 129, 0.3);
                    z-index: 1000;
                }
                
                @keyframes float-up {
                    0% { transform: translateY(0) scale(1) rotate(-5deg); }
                    30% { transform: translateY(-60px) scale(1.5) rotate(0deg); }
                    100% { transform: translateY(-150px) scale(1) rotate(5deg); }
                }
                
                @keyframes fade-out {
                    0% { opacity: 1; }
                    70% { opacity: 0.7; }
                    100% { opacity: 0; }
                }
                
                .confetti {
                    position: absolute;
                    width: 10px;
                    height: 10px;
                    background: #4a90e2;
                    opacity: 0;
                }
                
                @keyframes confetti-fall {
                    0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
                    100% { transform: translateY(1000px) rotate(720deg); opacity: 0; }
                }
                
                /* Responsive adjustments */
                @media (max-width: 768px) {
                    .quiz-container, .quiz-results {
                        margin: 20px 15px;
                        border-radius: 20px;
                    }
                    
                    .quiz-header {
                        padding: 25px 20px;
                    }
                    
                    .quiz-header h2 {
                        font-size: 24px;
                    }
                    
                    .quiz-questions {
                        padding: 20px;
                        gap: 30px;
                    }
                    
                    .quiz-question-inner {
                        padding: 25px 20px;
                    }
                    
                    .question-text {
                        font-size: 18px;
                        padding-left: 15px;
                    }
                    
                    .option-inner {
                        padding: 14px 16px;
                    }
                    
                    .option label {
                        font-size: 16px;
                    }
                    
                    .start-quiz-button, .submit-quiz-button, .close-quiz-button, .retake-quiz-button {
                        padding: 14px 28px;
                        font-size: 15px;
                    }
                    
                    .results-inner {
                        padding: 30px 20px;
                    }
                    
                    .quiz-results h3 {
                        font-size: 26px;
                    }
                    
                    .quiz-results p {
                        font-size: 18px;
                    }
                    
                    .score-circle {
                        width: 150px;
                        height: 150px;
                    }
                    
                    .score-text {
                        font-size: 40px;
                    }
                    
                    .score-text::after {
                        font-size: 20px;
                        right: -18px;
                    }
                }
            `;
            document.head.appendChild(styleSheet);
            
            // Add necessary HTML structure modifications
            document.addEventListener('DOMContentLoaded', function() {
                // Wrap question content in inner container
                document.querySelectorAll('.quiz-question').forEach((question, index) => {
                    const questionContent = question.innerHTML;
                    question.innerHTML = `
                        <div class="question-number">Question ${index + 1}</div>
                        <div class="quiz-question-inner">${questionContent}</div>
                    `;
                });
                
                // Wrap options content in inner container
                document.querySelectorAll('.option').forEach(option => {
                    const optionContent = option.innerHTML;
                    option.innerHTML = `<div class="option-inner">${optionContent}</div>`;
                });
                
                // Add header to quiz container
                const quizContainer = document.querySelector('.quiz-container');
                if (quizContainer) {
                    const headerElement = document.createElement('div');
                    headerElement.className = 'quiz-header';
                    headerElement.innerHTML = '<h2>Interactive Knowledge Quiz</h2>';
                    quizContainer.insertBefore(headerElement, quizContainer.firstChild);
                }
                
                // Wrap results content in inner container
                const resultsContainer = document.querySelector('.quiz-results');
                if (resultsContainer) {
                    const resultsContent = resultsContainer.innerHTML;
                    resultsContainer.innerHTML = `<div class="results-inner">${resultsContent}</div>`;
                    
                    // Add score circle if there's a percentage in the results
                    const resultsText = resultsContainer.textContent;
                    const percentMatch = resultsText.match(/(\d+)%/);
                    if (percentMatch) {
                        const percent = percentMatch[1];
                        const scoreContainer = document.createElement('div');
                        scoreContainer.className = 'score-container';
                        scoreContainer.innerHTML = `
                            <div class="score-circle">
                                <div class="score-text">${percent}</div>
                            </div>
                        `;
                        
                        const resultsInner = resultsContainer.querySelector('.results-inner');
                        resultsInner.insertBefore(scoreContainer, resultsInner.children[1]);
                    }
                }
                
                // Add confetti animation for correct answers
                function createConfetti() {
                    const colors = ['#4a90e2', '#805ad5', '#d53f8c', '#ed64a6', '#10B981', '#3B82F6'];
                    const container = document.body;
                    
                    for (let i = 0; i < 100; i++) {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + 'vw';
                        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.width = Math.random() * 10 + 5 + 'px';
                        confetti.style.height = Math.random() * 10 + 5 + 'px';
                        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                        confetti.style.animation = `confetti-fall ${Math.random() * 3 + 2}s linear forwards`;
                        confetti.style.animationDelay = Math.random() * 2 + 's';
                        container.appendChild(confetti);
                        
                        setTimeout(() => {
                            confetti.remove();
                        }, 5000);
                    }
                }
                
                // Trigger confetti when showing results with high score
                const submitButton = document.querySelector('.submit-quiz-button');
                if (submitButton) {
                    submitButton.addEventListener('click', function() {
                        setTimeout(() => {
                            const resultsText = document.querySelector('.quiz-results')?.textContent || '';
                            const percentMatch = resultsText.match(/(\d+)%/);
                            if (percentMatch && parseInt(percentMatch[1]) > 70) {
                                createConfetti();
                            }
                        }, 500);
                    });
                }
            });
        }




        // Funktion aufrufen, um die Stile hinzuzufügen
        addQuizStyles();
        

        // Setup device orientation for mobile devices
        function setupDeviceOrientation() {
            if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientation', function(event) {
                    const tiltX = event.beta;  // -90 to 90
                    const tiltY = event.gamma; // -90 to 90
                    
                    if (tiltX !== null && tiltY !== null) {
                        // Adjust star movement based on device tilt
                        for (let i = 0; i < stars.length; i++) {
                            const star = stars[i];
                            star.x += tiltY * star.speed * 0.1;
                            star.y += tiltX * star.speed * 0.1;
                            
                            // Keep stars within bounds
                            if (star.x < 0) star.x = universe.width;
                            if (star.x > universe.width) star.x = 0;
                            if (star.y < 0) star.y = universe.height;
                            if (star.y > universe.height) star.y = 0;
                        }
                    }
                });
            }
        }

      

        // Main function to generate quiz questions based on node content
        function generateQuizForNode(node) {
            // Extract and normalize node data with fallbacks
            const content = node.content || '';
            const title = node.title || 'This topic';
            const description = node.description || 'understanding key concepts in this field';
            const parentTitle = node.parentTitle || 'knowledge';
            const keywords = extractKeywords(content, description);
            
            // Generate question templates based on node context and complexity
            const questionTemplates = createQuestionTemplates(title, description, parentTitle, keywords);
            
            // Select and process questions
            return processQuestions(questionTemplates);
        }

        /**
         * Extract important keywords from content and description
         * @param {string} content - The node content
         * @param {string} description - The node description
         * @return {string[]} Array of keywords
         */
        function extractKeywords(content, description) {
            // Combine content and description
            const text = `${content} ${description}`;
            
            // Remove common words and extract potential keywords
            const commonWords = ['the', 'and', 'or', 'of', 'in', 'to', 'a', 'is', 'that', 'it', 'with', 'as', 'for', 'on', 'by'];
            const words = text.toLowerCase()
                .replace(/[^\w\s]/g, '')
                .split(/\s+/)
                .filter(word => word.length > 3 && !commonWords.includes(word));
            
            // Count word frequency
            const wordCount = {};
            words.forEach(word => {
                wordCount[word] = (wordCount[word] || 0) + 1;
            });
            
            // Sort by frequency and return top keywords
            return Object.entries(wordCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10)
                .map(entry => entry[0]);
        }

        /**
         * Create diverse question templates with contextual variations
         * @param {string} title - The node title
         * @param {string} description - The node description
         * @param {string} parentTitle - The parent node title
         * @param {string[]} keywords - Extracted keywords
         * @return {Object[]} Array of question templates
         */
        function createQuestionTemplates(title, description, parentTitle, keywords) {
            // Create question categories for better organization and variety
            return [
                // Conceptual Understanding Questions
                ...createConceptualQuestions(title, description, parentTitle),
                
                // Analytical Questions
                ...createAnalyticalQuestions(title, description, keywords),
                
                // Application Questions
                ...createApplicationQuestions(title, description),
                
                // Contextual Questions
                ...createContextualQuestions(title, description, parentTitle),
                
                // Advanced Questions
                ...createAdvancedQuestions(title, description, keywords)
            ];
        }

        /**
         * Create conceptual understanding questions
         */
        function createConceptualQuestions(title, description, parentTitle) {
            return [
                {
                    question: `Which statement most accurately characterizes ${title}?`,
                    options: [
                        description,
                        `The opposite of ${description.toLowerCase()}`,
                        `A field unrelated to ${parentTitle}`,
                        `A concept primarily concerned with physical objects`
                    ],
                    correctAnswer: 0,
                    difficulty: 'basic'
                },
                {
                    question: `What constitutes the primary focus of ${title}?`,
                    options: [
                        "Quantitative measurement and statistical analysis",
                        "Historical documentation and archival research",
                        description.toLowerCase(),
                        "Commercial applications and profit generation"
                    ],
                    correctAnswer: 2,
                    difficulty: 'basic'
                },
                {
                    question: `How would an expert in ${parentTitle} define ${title}?`,
                    options: [
                        `A subset of ${parentTitle} with limited practical applications`,
                        description,
                        `A theoretical framework without empirical support`,
                        `An outdated concept in modern ${parentTitle}`
                    ],
                    correctAnswer: 1,
                    difficulty: 'intermediate'
                }
            ];
        }

        /**
         * Create analytical questions
         */
        function createAnalyticalQuestions(title, description, keywords) {
            const keywordQuestion = keywords.length > 0 ? 
                {
                    question: `Which concept is most closely associated with ${title}?`,
                    options: [
                        keywords[0] || "Theoretical frameworks",
                        "Unrelated methodologies",
                        "Opposing viewpoints",
                        "Historical artifacts"
                    ],
                    correctAnswer: 0,
                    difficulty: 'intermediate'
                } : null;
            
            return [
                {
                    question: `How does ${title} differ from related disciplines?`,
                    options: [
                        "It lacks theoretical foundations",
                        `It uniquely emphasizes ${description.toLowerCase()}`,
                        "It relies exclusively on quantitative methods",
                        "It rejects practical applications in favor of theory"
                    ],
                    correctAnswer: 1,
                    difficulty: 'intermediate'
                },
                {
                    question: `Which cognitive abilities are most valuable when exploring ${title}?`,
                    options: [
                        "Rote memorization of facts",
                        "Critical thinking and analytical reasoning",
                        "Computational calculation",
                        "Procedural execution of established techniques"
                    ],
                    correctAnswer: 1,
                    difficulty: 'basic'
                },
                keywordQuestion
            ].filter(q => q !== null); // Remove null questions
        }

        /**
         * Create application questions
         */
        function createApplicationQuestions(title, description) {
            return [
                {
                    question: `In what way does ${title} enhance our understanding of the world?`,
                    options: [
                        "It has minimal impact on knowledge frameworks",
                        `By providing insights into ${description.toLowerCase()}`,
                        "Exclusively through technological innovation",
                        "Only through its influence on economic systems"
                    ],
                    correctAnswer: 1,
                    difficulty: 'intermediate'
                },
                {
                    question: `Which methodological approaches characterize research in ${title}?`,
                    options: [
                        "Strictly qualitative ethnographic studies",
                        "Exclusively quantitative laboratory experiments",
                        "Integrated methodologies appropriate to the subject matter",
                        "Rejection of established research paradigms"
                    ],
                    correctAnswer: 2,
                    difficulty: 'advanced'
                },
                {
                    question: `How might a practitioner apply knowledge of ${title} in a real-world context?`,
                    options: [
                        "By ignoring theoretical foundations completely",
                        "By applying concepts to solve relevant problems",
                        "By focusing exclusively on historical precedents",
                        "By rejecting established methodologies"
                    ],
                    correctAnswer: 1,
                    difficulty: 'intermediate'
                }
            ];
        }

        /**
         * Create contextual questions
         */
        function createContextualQuestions(title, description, parentTitle) {
            return [
                {
                    question: `How has the field of ${title} developed over time?`,
                    options: [
                        "It has remained static since its initial formulation",
                        "Through ongoing refinement of knowledge and evolving paradigms",
                        "It emerged fully formed in recent decades",
                        "It has narrowed in scope and relevance"
                    ],
                    correctAnswer: 1,
                    difficulty: 'intermediate'
                },
                {
                    question: `What characterizes the relationship between theory and application in ${title}?`,
                    options: [
                        "Theory and practice operate independently",
                        "Theory informs practice, and practice refines theoretical understanding",
                        "Theory supersedes practical considerations",
                        "Practice renders theoretical frameworks obsolete"
                    ],
                    correctAnswer: 1,
                    difficulty: 'intermediate'
                },
                {
                    question: `How does ${title} relate to the broader field of ${parentTitle}?`,
                    options: [
                        `It contradicts the fundamental principles of ${parentTitle}`,
                        `It represents a specialized area within ${parentTitle}`,
                        `It has no meaningful connection to ${parentTitle}`,
                        `It has replaced traditional approaches to ${parentTitle}`
                    ],
                    correctAnswer: 1,
                    difficulty: 'advanced'
                }
            ];
        }

        /**
         * Create advanced questions
         */
        function createAdvancedQuestions(title, description, keywords) {
            return [
                {
                    question: `Which ethical considerations are most relevant to ${title}?`,
                    options: [
                        "Ethics are peripheral to this field",
                        "Only regulatory compliance matters",
                        "Responsible knowledge application and impact assessment",
                        "Maximizing efficiency regardless of consequences"
                    ],
                    correctAnswer: 2,
                    difficulty: 'advanced'
                },
                {
                    question: `What future developments might we anticipate in ${title}?`,
                    options: [
                        "Declining relevance in contemporary discourse",
                        "Stability without significant change",
                        "Continued evolution reflecting new discoveries and changing contexts",
                        "Complete transformation into an unrecognizable discipline"
                    ],
                    correctAnswer: 2,
                    difficulty: 'advanced'
                },
                {
                    question: `Which key principle underlies most work in ${title}?`,
                    options: [
                        "Adherence to established authorities",
                        "Rejection of traditional frameworks",
                        `The exploration of ${description.toLowerCase()}`,
                        "Prioritization of economic value"
                    ],
                    correctAnswer: 2,
                    difficulty: 'intermediate'
                },
                {
                    question: `How might someone begin studying ${title}?`,
                    options: [
                        "By memorizing key facts without context",
                        "By exploring foundational concepts and their relationships",
                        "By focusing exclusively on practical applications",
                        "By rejecting existing knowledge in the field"
                    ],
                    correctAnswer: 1,
                    difficulty: 'basic'
                }
            ];
        }

        /**
         * Process questions to ensure quality and variety
         * @param {Object[]} questionTemplates - Array of question templates
         * @return {Object[]} Processed questions
         */
        function processQuestions(questionTemplates) {
            // Ensure we have a mix of difficulty levels
            const basicQuestions = questionTemplates.filter(q => q.difficulty === 'basic');
            const intermediateQuestions = questionTemplates.filter(q => q.difficulty === 'intermediate');
            const advancedQuestions = questionTemplates.filter(q => q.difficulty === 'advanced');
            
            // Select questions with appropriate distribution
            const selectedQuestions = [
                ...shuffleArray(basicQuestions).slice(0, 4),
                ...shuffleArray(intermediateQuestions).slice(0, 4),
                ...shuffleArray(advancedQuestions).slice(0, 2)
            ];
            
            // Shuffle the final selection
            const finalQuestions = shuffleArray(selectedQuestions);
            
            // Process each question to ensure quality
            return finalQuestions.slice(0, 10).map(q => {
                // Ensure correct grammar and formatting
                const question = q.question.replace(/\s{2,}/g, ' ').trim();
                
                // Ensure options are unique and well-formatted
                const options = q.options.map(opt => 
                    opt.charAt(0).toUpperCase() + opt.slice(1).replace(/\s{2,}/g, ' ').trim()
                );
                
                // Return cleaned question
                return {
                    question,
                    options,
                    correctAnswer: q.correctAnswer
                };
            });
        }

        /**
         * Enhanced knowledge structure with improved quizzes
         * @param {Object} structure - The knowledge structure
         * @return {Object} Enhanced structure with quizzes
         */
        function addQuizzesToKnowledgeStructure(structure) {
            // Add comprehensive quiz to base node with diverse question types
            structure.quiz = [
                // Foundational Knowledge Questions
                {
                    question: "Which characterization of knowledge is most accurate?",
                    options: [
                        "Observable physical phenomena",
                        "Theoretical or practical understanding of subjects",
                        "Innate ideas present from birth",
                        "Information accessible only to experts"
                    ],
                    correctAnswer: 1
                },
                {
                    question: "Throughout human history, which pursuit has remained consistently central?",
                    options: [
                        "The accumulation of material wealth",
                        "The acquisition and transmission of knowledge",
                        "The establishment of political dominance",
                        "The development of entertainment forms"
                    ],
                    correctAnswer: 1
                },
                
                // Philosophical Foundations
                {
                    question: "Which philosophical field specifically examines the nature and foundations of knowledge?",
                    options: [
                        "Ontology",
                        "Epistemology",
                        "Axiology",
                        "Deontology"
                    ],
                    correctAnswer: 1
                },
                {
                    question: "What fundamental distinction separates tacit knowledge from explicit knowledge?",
                    options: [
                        "Tacit knowledge is always more valuable than explicit knowledge",
                        "Explicit knowledge is exclusively scientific in nature",
                        "Tacit knowledge resists formal articulation and direct transmission",
                        "Explicit knowledge cannot be documented systematically"
                    ],
                    correctAnswer: 2
                },
                
                // Cognitive Processes
                {
                    question: "Which cognitive process forms the foundation of knowledge acquisition?",
                    options: [
                        "Rote memorization of facts",
                        "Perception and processing of sensory information",
                        "Mathematical calculation",
                        "Creative imagination"
                    ],
                    correctAnswer: 1
                },
                {
                    question: "In epistemological discourse, what does the concept of 'justified true belief' represent?",
                    options: [
                        "A religious doctrine with empirical verification",
                        "A classical formulation of the definition of knowledge",
                        "A legal standard for admissible evidence",
                        "A psychological state of absolute certainty"
                    ],
                    correctAnswer: 1
                },
                
                // Organizational Knowledge
                {
                    question: "How does the process of 'knowledge transfer' function within organizational contexts?",
                    options: [
                        "It refers exclusively to formal educational programs",
                        "It describes the physical relocation of documents between departments",
                        "It encompasses the movement of knowledge between individuals and groups in organizations",
                        "It exclusively refers to technological data migration between systems"
                    ],
                    correctAnswer: 2
                },
                {
                    question: "What distinguishes a 'knowledge economy' from other economic models?",
                    options: [
                        "Its primary emphasis on tangible goods production",
                        "Its prioritization of intellectual capital over physical resources",
                        "Its focus on agricultural output and natural resource extraction",
                        "Its elimination of economic scarcity through information abundance"
                    ],
                    correctAnswer: 1
                },
                
                // Cognitive Biases and Information Processing
                {
                    question: "Which cognitive bias most directly impedes knowledge acquisition?",
                    options: [
                        "Confirmation bias - seeking information that confirms existing beliefs",
                        "The gambler's fallacy - misunderstanding probability in sequential events",
                        "The Dunning-Kruger effect - overestimating competence when knowledge is limited",
                        "Hindsight bias - believing events were predictable after they occurred"
                    ],
                    correctAnswer: 0
                },
                {
                    question: "Within the DIKW pyramid framework, what relationship exists between data, information, and knowledge?",
                    options: [
                        "They are interchangeable terms with no hierarchical structure",
                        "Data transforms into information through contextualization, which develops into knowledge through experience",
                        "Knowledge breaks down into information, which further decomposes into raw data",
                        "They represent parallel and independent concepts with no transformation pathway"
                    ],
                    correctAnswer: 1
                },
                
                // Knowledge Integration
                {
                    question: "What distinguishes knowledge from mere information?",
                    options: [
                        "Knowledge is always digital while information is analog",
                        "Information becomes knowledge when integrated into existing cognitive frameworks",
                        "Knowledge is objective while information is subjective",
                        "Information is always more valuable than knowledge"
                    ],
                    correctAnswer: 1
                },
                {
                    question: "Which form of reasoning moves from specific observations toward general principles?",
                    options: [
                        "Deductive reasoning",
                        "Inductive reasoning",
                        "Abductive reasoning",
                        "Syllogistic reasoning"
                    ],
                    correctAnswer: 1
                }
            ];
            
            // Add enhanced quizzes for first-level children
            if (structure.children) {
                // Art & Creativity
                structure.children[0].quiz = createArtAndCreativityQuiz();
                
                // Philosophy
                structure.children[1].quiz = createPhilosophyQuiz();
                
                // Personal Development
                structure.children[2].quiz = createPersonalDevelopmentQuiz();
                
                // Add enhanced quizzes to second level children with parent context
                for (let i = 0; i < structure.children.length; i++) {
                    if (structure.children[i].children) {
                        for (let j = 0; j < structure.children[i].children.length; j++) {
                            const secondLevelNode = structure.children[i].children[j];
                            // Add parent title for context in questions
                            secondLevelNode.parentTitle = structure.children[i].title;
                            secondLevelNode.quiz = generateQuizForNode(secondLevelNode);
                        }
                    }
                }
            }
            
            return structure;
        }

        /**
         * Create specialized quiz for Art & Creativity
         */
        function createArtAndCreativityQuiz() {
            return [
                // Conceptual Understanding
                {
                    question: "Which definition most comprehensively describes the scope of art?",
                    options: [
                        "Visual representations created with traditional media",
                        "Performances conducted before live audiences",
                        "The diverse range of human creative expression across multiple domains",
                        "Digital content created using computational tools"
                    ],
                    correctAnswer: 2
                },
                {
                    question: "Which two fundamental processes comprise creative activity?",
                    options: [
                        "Planning and execution",
                        "Ideation and production",
                        "Learning and replication",
                        "Conception and marketing"
                    ],
                    correctAnswer: 1
                },
                
                // Cognitive Processes
                {
                    question: "Which cognitive mode is most strongly associated with artistic innovation?",
                    options: [
                        "Convergent thinking - finding the single best solution",
                        "Divergent thinking - generating multiple possible solutions",
                        "Analytical reasoning - breaking problems into components",
                        "Deductive logic - applying general principles to specific cases"
                    ],
                    correctAnswer: 1
                },
                {
                    question: "How is the psychological state of 'flow' characterized in creative work?",
                    options: [
                        "A technique for applying media smoothly across surfaces",
                        "A state of complete absorption and focused concentration in an activity",
                        "A business strategy for maximizing artistic output",
                        "A methodological approach to creative project management"
                    ],
                    correctAnswer: 1
                },
                
                // Creative Dynamics
                {
                    question: "What paradoxical relationship exists between constraints and creativity?",
                    options: [
                        "Constraints universally inhibit creative expression",
                        "Constraints have no measurable effect on creative output",
                        "Constraints often enhance creativity by providing productive boundaries",
                        "Constraints only limit novices while professionals remain unaffected"
                    ],
                    correctAnswer: 2
                },
                {
                    question: "What primary quality distinguishes artistic expression from other communication forms?",
                    options: [
                        "Its requirement for specialized tools and materials",
                        "Its emphasis on aesthetic and emotional dimensions",
                        "Its universal comprehensibility across cultures",
                        "Its inability to convey specific messages"
                    ],
                    correctAnswer: 1
                },
                
                // Neuroscience of Creativity
                {
                    question: "Which neurological process most closely correlates with creative insight?",
                    options: [
                        "Increased alpha wave synchronization across brain regions",
                        "Heightened activity in the prefrontal cortical areas",
                        "Novel connections forming between previously unassociated neural networks",
                        "Decreased overall cerebral activity during incubation phases"
                    ],
                    correctAnswer: 2
                },
                
                // Skill Development
                {
                    question: "What relationship exists between technical proficiency and creative expression?",
                    options: [
                        "Technical skill has no bearing on creative capacity",
                        "Technical skill is synonymous with creativity",
                        "Technical skill provides the foundation that enables sophisticated creative expression",
                        "Technical skill inhibits authentic creative innovation"
                    ],
                    correctAnswer: 2
                },
                
                // Motivation and Process
                {
                    question: "How does intrinsic motivation differ from extrinsic motivation in creative contexts?",
                    options: [
                        "Intrinsic motivation derives from external rewards and recognition",
                        "Extrinsic motivation stems from internal satisfaction",
                        "Intrinsic motivation arises from engagement with the process itself",
                        "There is no meaningful distinction between motivation types"
                    ],
                    correctAnswer: 2
                },
                {
                    question: "What does the concept of 'creative destruction' describe in artistic evolution?",
                    options: [
                        "The physical deterioration of artistic works over time",
                        "The process by which new artistic movements supplant established conventions",
                        "The intentional vandalism of public artworks",
                        "The gradual erosion of technical skill through automation"
                    ],
                    correctAnswer: 1
                },
                
                // Psychological Factors
                {
                    question: "Which psychological trait correlates most strongly with creative achievement?",
                    options: [
                        "Risk aversion and preference for stability",
                        "Openness to experience and cognitive flexibility",
                        "Conscientiousness and methodical planning",
                        "Extroversion and social dominance"
                    ],
                    correctAnswer: 1
                },
                {
                    question: "How do 'associative barriers' influence creative thought?",
                    options: [
                        "They enhance creativity by providing necessary structure",
                        "They have no effect on creative processes",
                        "They inhibit creativity by limiting conceptual combinations",
                        "They only affect artistic domains, not scientific creativity"
                    ],
                    correctAnswer: 2
                }
            ];
        }

        /**
         * Create specialized quiz for Philosophy
         */
        function createPhilosophyQuiz() {
            return [
                // Conceptual Foundations
                {
                    question: "What is the most accurate characterization of philosophy as a discipline?",
                    options: [
                        "The empirical study of celestial bodies and cosmological phenomena",
                        "The systematic investigation of fundamental questions concerning existence, knowledge, values, reason, and mind",
                        "The practice of contemplative meditation aimed at personal enlightenment",
                        "The chronological documentation of significant historical events"
                    ],
                    correctAnswer: 1
                },
                {
                    question: "What methodological approach distinguishes philosophy from other fields of inquiry?",
                    options: [
                        "Its reliance on controlled laboratory experimentation",
                        "Its exclusive use of empirical observation and measurement",
                        "Its emphasis on critical discourse, conceptual analysis, and rational argumentation",
                        "Its foundation in revealed religious doctrines"
                    ],
                    correctAnswer: 2
                },
                
                // Epistemology
                {
                    question: "What constitutes the central concern of epistemology?",
                    options: [
                        "The nature and categories of existence",
                        "The nature, sources, and limitations of knowledge",
                        "The principles of beauty and artistic taste",
                        "The foundations of moral judgment and ethical systems"
                    ],
                    correctAnswer: 1
                },
                
                // Ontology
                {
                    question: "Which philosophical subdiscipline addresses the fundamental question 'What exists?'",
                    options: [
                        "Epistemology",
                        "Ethics",
                        "Ontology",
                        "Aesthetics"
                    ],
                    correctAnswer: 2
                },
                
                // Philosophy of Mind
                {
                    question: "What problem does the 'mind-body' question address in philosophy?",
                    options: [
                        "A medical condition affecting philosophical thinkers",
                        "The relationship between physical exercise and cognitive function",
                        "The relationship between mental phenomena and physical processes",
                        "The debate regarding physical education in academic curricula"
                    ],
                    correctAnswer: 2
                },
                
                // Philosophical Traditions
                {
                    question: "What key characteristic distinguishes analytic philosophy from continental philosophy?",
                    options: [
                        "Analytic philosophy emphasizes precise language, logical analysis, and conceptual clarity",
                        "Continental philosophy is exclusively practiced in European academic institutions",
                        "Analytic philosophy categorically rejects all metaphysical inquiries",
                        "Continental philosophy never employs logical argumentation"
                    ],
                    correctAnswer: 0
                },
                
                // Ethics
                {
                    question: "What is the 'categorical imperative' in Kantian ethics?",
                    options: [
                        "A system for categorizing moral actions into discrete types",
                        "A principle stating one should act only according to maxims that could become universal laws",
                        "The doctrine that consequences determine the moral worth of actions",
                        "The thesis that moral rules are culturally relative"
                    ],
                    correctAnswer: 1
                },
                
                // Philosophy of Science
                {
                    question: "What is the central issue in the 'problem of induction' in philosophy of science?",
                    options: [
                        "The difficulty of motivating students to pursue scientific education",
                        "The challenge of justifying general laws based on limited observations",
                        "The problem of recruiting qualified scientific researchers",
                        "The challenge of applying theoretical scientific knowledge to technological development"
                    ],
                    correctAnswer: 1
                },
                
                // Phenomenology
                {
                    question: "What primary focus characterizes phenomenology as a philosophical approach?",
                    options: [
                        "The investigation of supernatural and paranormal phenomena",
                        "The examination of conscious experience from the first-person perspective",
                        "The study of physical phenomena in the natural world",
                        "The analysis of social phenomena in human groups"
                    ],
                    correctAnswer: 1
                },
                
                // Meta-ethics
                {
                    question: "What philosophical challenge does the 'is-ought problem' present in ethics?",
                    options: [
                        "The question of whether ethical inquiry has legitimate value",
                        "The problem of determining appropriate moral actions",
                        "The logical gap between descriptive statements about what is and prescriptive claims about what ought to be",
                        "The difficulty of implementing theoretical ethical frameworks in practical situations"
                    ],
                    correctAnswer: 2
                },
                
                // Philosophy of Language
                {
                    question: "Which concept in philosophy of language refers to how words connect to their referents?",
                    options: [
                        "Syntax",
                        "Pragmatics",
                        "Reference theory",
                        "Grammatical structure"
                    ],
                    correctAnswer: 2
                },
                
                // Epistemological Categories
                {
                    question: "What distinguishes a priori knowledge from a posteriori knowledge?",
                    options: [
                        "A priori knowledge is more valuable than a posteriori knowledge",
                        "A priori knowledge is independent of experience, while a posteriori knowledge derives from experience",
                        "A priori knowledge is scientific, while a posteriori knowledge is philosophical",
                        "A priori knowledge is ancient, while a posteriori knowledge is modern"
                    ],
                    correctAnswer: 1
                }
            ];
        }

        /**
         * Create specialized quiz for Personal Development
         */
        function createPersonalDevelopmentQuiz() {
            return [
                // Conceptual Foundations
                {
                    question: "What comprehensive definition best describes personal development?",
                    options: [
                        "Professional skill acquisition for career advancement",
                        "Academic achievement through formal educational institutions",
                        "Conscious activities that enhance awareness, identity, capabilities, and potential",
                        "Physical fitness regimens designed to improve health"
                    ],
                    correctAnswer: 2
                },
                {
                    question: "What temporal scope characterizes personal development?",
                    options: [
                        "It occurs exclusively during early developmental stages",
                        "It applies only to professional contexts during working years",
                        "It is limited to engagement with self-improvement literature",
                        "It spans an individual's entire lifespan as an ongoing process"
                    ],
                    correctAnswer: 3
                },
                
                // Mindset and Learning
                {
                    question: "What mindset does Carol Dweck's concept of 'growth mindset' represent?",
                    options: [
                        "The belief that intelligence and abilities are fixed, innate traits",
                        "The belief that intelligence and abilities can develop through dedication and strategic effort",
                        "An exclusive focus on physical development and growth",
                        "A marketing approach for self-improvement products"
                    ],
                    correctAnswer: 1
                },
                {
                    question: "How does metacognition contribute to personal development processes?",
                    options: [
                        "It has no significant relationship to developmental outcomes",
                        "It refers to physical exercises that enhance cognitive function",
                        "It involves awareness and regulation of one's own thinking processes",
                        "It's a technique for rapidly memorizing information"
                    ],
                    correctAnswer: 2
                },
                
                // Learning Theory
                {
                    question: "What does Vygotsky's 'zone of proximal development' represent in learning theory?",
                    options: [
                        "The physical environment most conducive to effective learning",
                        "The distance between what a learner can do independently and what can be achieved with guidance",
                        "The maximum developmental potential an individual can reach",
                        "The optimal temperature range for cognitive functioning"
                    ],
                    correctAnswer: 1
                },
                {
                    question: "How does 'deliberate practice' differ from casual practice approaches?",
                    options: [
                        "It requires greater time investment but not increased effort",
                        "It emphasizes quantity of practice over quality",
                        "It involves targeted focus on improving specific aspects with feedback integration",
                        "It necessitates professional coaching supervision"
                    ],
                    correctAnswer: 2
                },
                
                // Emotional Intelligence
                {
                    question: "What concept does 'emotional intelligence' represent in personal development?",
                    options: [
                        "The capacity to suppress emotional responses",
                        "The ability to perceive, understand, manage, and effectively express emotions and navigate interpersonal relationships",
                        "A measurement of emotional sensitivity and reactivity",
                        "A pseudoscientific construct without empirical validation"
                    ],
                    correctAnswer: 1
                },
                
                // Reflective Practice
                {
                    question: "What function does self-reflection serve in personal growth processes?",
                    options: [
                        "It impedes development by promoting excessive introspection",
                        "It benefits only specific personality types",
                        "It enables learning from experience and develops metacognitive awareness",
                        "It requires professional therapeutic guidance to be effective"
                    ],
                    correctAnswer: 2
                },
                
                // Neuroplasticity
                {
                    question: "How does neuroplasticity relate to personal development potential?",
                    options: [
                        "It indicates that brain development ceases after childhood",
                        "It describes the brain's lifelong capacity to reorganize neural pathways based on experience",
                        "It represents a pathological condition that inhibits learning",
                        "It applies exclusively to recovery from neurological trauma"
                    ],
                    correctAnswer: 1
                },
                
                // Goal Setting
                {
                    question: "What relationship exists between goal-setting and effective personal development?",
                    options: [
                        "Effective development requires specific, measurable, achievable, relevant, and time-bound objectives",
                        "Goals are irrelevant to authentic developmental processes",
                        "Only long-term aspirational goals contribute to development",
                        "Goal-setting interferes with natural developmental trajectories"
                    ],
                    correctAnswer: 0
                },
                
                // Learning Approaches
                {
                    question: "Which learning approach emphasizes the integration of new information with existing knowledge structures?",
                    options: [
                        "Behaviorist learning theory",
                        "Constructivist learning theory",
                        "Operant conditioning",
                        "Classical conditioning"
                    ],
                    correctAnswer: 1
                },
                
                // Growth Through Challenge
                {
                    question: "What role does failure play in optimal personal development?",
                    options: [
                        "Failure should be avoided at all costs",
                        "Failure provides essential feedback and learning opportunities when approached constructively",
                        "Failure indicates a fundamental lack of ability",
                        "Failure is relevant only in academic contexts"
                    ],
                    correctAnswer: 1
                }
            ];
        }

        /**
         * Create personalized quiz based on user performance
         * @param {Object} knowledgeStructure - The knowledge structure
         * @param {Object} userPerformance - User performance data
         * @return {Object} Personalized quiz
         */
        function createPersonalizedQuiz(knowledgeStructure, userPerformance) {
            // Track areas where user needs improvement
            const weakAreas = [];
            const strongAreas = [];
            
            // Analyze user performance if available
            if (userPerformance) {
                for (const topic in userPerformance) {
                    if (userPerformance[topic] < 70) { // Below 70% is considered a weak area
                        weakAreas.push(topic);
                    } else {
                        strongAreas.push(topic);
                    }
                }
            }
            
        
            const personalizedQuiz = {
                title: "Personalized Knowledge Assessment",
                description: "This quiz is tailored to your learning progress, focusing on areas that need reinforcement while building on your strengths.",
                questions: []
            };
            
            // Function to find a node by title with depth-first search
            function findNodeByTitle(node, title) {
                if (node.title === title) return node;
                if (node.children) {
                    for (const child of node.children) {
                        const found = findNodeByTitle(child, title);
                        if (found) return found;
                    }
                }
                return null;
            }
            
            // Add questions from weak areas first (prioritize these)
            for (const area of weakAreas) {
                const node = findNodeByTitle(knowledgeStructure, area);
                if (node && node.quiz) {
                    // Add more questions from weak areas (up to 3 per weak area)
                    const areaQuestions = shuffleArray([...node.quiz]).slice(0, 3);
                    personalizedQuiz.questions.push(...areaQuestions);
                }
            }
            
            // Add some questions from strong areas for reinforcement and confidence building
            for (const area of strongAreas) {
                if (personalizedQuiz.questions.length >= 7) break; // Leave room for general questions
                
                const node = findNodeByTitle(knowledgeStructure, area);
                if (node && node.quiz) {
                    // Add 1 question from each strong area
                    const areaQuestion = shuffleArray([...node.quiz])[0];
                    personalizedQuiz.questions.push(areaQuestion);
                }
            }
            
            // Add some questions from the general knowledge areas
            if (knowledgeStructure.quiz && personalizedQuiz.questions.length < 10) {
                const remainingSlots = 10 - personalizedQuiz.questions.length;
                personalizedQuiz.questions.push(
                    ...shuffleArray([...knowledgeStructure.quiz]).slice(0, remainingSlots)
                );
            }
            
            // Shuffle the questions for better learning experience
            personalizedQuiz.questions = shuffleArray(personalizedQuiz.questions);
            
            // Limit to 10 questions
            personalizedQuiz.questions = personalizedQuiz.questions.slice(0, 10);
            
            // Add metadata to help with learning
            personalizedQuiz.metadata = {
                focusAreas: weakAreas,
                reinforcementAreas: strongAreas,
                questionCount: personalizedQuiz.questions.length,
                difficulty: calculateQuizDifficulty(personalizedQuiz.questions)
            };
            
            return personalizedQuiz;
        }

        /**
         * Calculate the overall difficulty of a quiz based on its questions
         * @param {Object[]} questions - Array of quiz questions
         * @return {string} Difficulty level
         */
        function calculateQuizDifficulty(questions) {
            // If we have difficulty metadata, use it
            const difficultyLevels = questions
                .filter(q => q.difficulty)
                .map(q => q.difficulty);
            
            if (difficultyLevels.length > 0) {
                const basicCount = difficultyLevels.filter(d => d === 'basic').length;
                const intermediateCount = difficultyLevels.filter(d => d === 'intermediate').length;
                const advancedCount = difficultyLevels.filter(d => d === 'advanced').length;
                
                const totalWithDifficulty = difficultyLevels.length;
                
                if (advancedCount / totalWithDifficulty > 0.5) return 'advanced';
                if (intermediateCount / totalWithDifficulty > 0.5) return 'intermediate';
                return 'basic';
            }
            
            // Default difficulty estimation based on question complexity
            let complexityScore = 0;
            
            for (const question of questions) {
                // Longer questions tend to be more complex
                complexityScore += question.question.length / 50;
                
                // Questions with longer options tend to be more complex
                const avgOptionLength = question.options.reduce((sum, opt) => sum + opt.length, 0) / question.options.length;
                complexityScore += avgOptionLength / 30;
            }
            
            const avgComplexity = complexityScore / questions.length;
            
            if (avgComplexity > 3) return 'advanced';
            if (avgComplexity > 2) return 'intermediate';
            return 'basic';
        }

        /**
         * Function to shuffle array using Fisher-Yates algorithm
         * @param {Array} array - The array to shuffle
         * @return {Array} Shuffled array
         */
        function shuffleArray(array) {
            const newArray = [...array]; // Create a copy to avoid modifying the original
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        /**
         * Generate a quiz with spaced repetition for optimal learning
         * @param {Object} knowledgeStructure - The knowledge structure
         * @param {Object} userHistory - User's learning history
         * @return {Object} Spaced repetition quiz
         */
        function generateSpacedRepetitionQuiz(knowledgeStructure, userHistory) {
            // Default return if no history is available
            if (!userHistory || !userHistory.questions) {
                return createPersonalizedQuiz(knowledgeStructure, null);
            }
            
            // Track questions due for review based on spaced repetition algorithm
            const dueForReview = [];
            const now = new Date().getTime();
            
            // Analyze user history to find questions due for review
            for (const [questionId, data] of Object.entries(userHistory.questions)) {
                // Skip questions with perfect recall (level 5+) unless it's been a long time
                if (data.level >= 5 && now - data.lastSeen < 30 * 24 * 60 * 60 * 1000) { // 30 days
                    continue;
                }
                
                // Calculate next review time based on spaced repetition formula
                const reviewInterval = calculateReviewInterval(data.level, data.lastSeen);
                
                if (now >= reviewInterval) {
                    dueForReview.push({
                        questionId,
                        priority: (now - reviewInterval) / (24 * 60 * 60 * 1000), // Priority based on days overdue
                        level: data.level,
                        lastSeen: data.lastSeen
                    });
                }
            }
            
            // Sort by priority (most overdue first)
            dueForReview.sort((a, b) => b.priority - a.priority);
            
            // Create quiz with spaced repetition questions and some new content
            const spacedRepetitionQuiz = {
                title: "Knowledge Reinforcement Quiz",
                description: "This quiz uses spaced repetition to help you retain knowledge over time.",
                questions: []
            };
            
            // Add due review questions (up to 7)
            const reviewQuestions = dueForReview.slice(0, 7).map(item => {
                return findQuestionById(knowledgeStructure, item.questionId);
            }).filter(q => q !== null); // Filter out any questions that couldn't be found
            
            spacedRepetitionQuiz.questions.push(...reviewQuestions);
            
            // Add some new questions to keep learning fresh
            const newQuestionCount = 10 - spacedRepetitionQuiz.questions.length;
            if (newQuestionCount > 0) {
                const newQuestions = generateNewQuestions(knowledgeStructure, userHistory, newQuestionCount);
                spacedRepetitionQuiz.questions.push(...newQuestions);
            }
            
            // Add metadata
            spacedRepetitionQuiz.metadata = {
                reviewQuestionCount: reviewQuestions.length,
                newQuestionCount: spacedRepetitionQuiz.questions.length - reviewQuestions.length,
                spacedRepetition: true
            };
            
            return spacedRepetitionQuiz;
        }

        /**
         * Calculate the next review interval based on spaced repetition principles
         * @param {number} level - Current mastery level (0-5)
         * @param {number} lastSeen - Timestamp when last reviewed
         * @return {number} Next review timestamp
         */
        function calculateReviewInterval(level, lastSeen) {
            // Fibonacci-like spacing: 1, 2, 5, 8, 13, 21 days
            const intervals = [
                1 * 24 * 60 * 60 * 1000,    // 1 day in milliseconds
                2 * 24 * 60 * 60 * 1000,    // 2 days
                5 * 24 * 60 * 60 * 1000,    // 5 days
                8 * 24 * 60 * 60 * 1000,    // 8 days
                13 * 24 * 60 * 60 * 1000,   // 13 days
                21 * 24 * 60 * 60 * 1000    // 21 days
            ];
            
            const interval = intervals[Math.min(level, intervals.length - 1)];
            return lastSeen + interval;
        }

        /**
         * Find a question by its ID in the knowledge structure
         * @param {Object} node - Current node in knowledge structure
         * @param {string} questionId - ID of the question to find
         * @return {Object|null} The question object or null if not found
         */
        function findQuestionById(node, questionId) {
            // Check if this node has the question
            if (node.quiz) {
                const question = node.quiz.find(q => q.id === questionId);
                if (question) return question;
            }
            
            // Recursively check children
            if (node.children) {
                for (const child of node.children) {
                    const found = findQuestionById(child, questionId);
                    if (found) return found;
                }
            }
            
            return null;
        }

        /**
         * Generate new questions the user hasn't seen before
         * @param {Object} knowledgeStructure - The knowledge structure
         * @param {Object} userHistory - User's learning history
         * @param {number} count - Number of new questions to generate
         * @return {Object[]} Array of new questions
         */
        function generateNewQuestions(knowledgeStructure, userHistory, count) {
            // Collect all questions from the knowledge structure
            const allQuestions = collectAllQuestions(knowledgeStructure);
            
            // Filter out questions the user has already seen
            const seenQuestionIds = Object.keys(userHistory.questions || {});
            const unseenQuestions = allQuestions.filter(q => 
                !seenQuestionIds.includes(q.id)
            );
            
            // If we have enough unseen questions, return a random selection
            if (unseenQuestions.length >= count) {
                return shuffleArray(unseenQuestions).slice(0, count);
            }
            
            // If we don't have enough unseen questions, include some least-recently-seen questions
            const result = [...unseenQuestions];
            
            if (result.length < count && seenQuestionIds.length > 0) {
                // Sort seen questions by last seen timestamp (oldest first)
                const seenQuestions = seenQuestionIds
                    .map(id => ({
                        question: findQuestionById(knowledgeStructure, id),
                        lastSeen: userHistory.questions[id].lastSeen
                    }))
                    .filter(item => item.question !== null)
                    .sort((a, b) => a.lastSeen - b.lastSeen)
                    .map(item => item.question);
                
                // Add oldest seen questions until we reach the desired count
                result.push(...seenQuestions.slice(0, count - result.length));
            }
            
            return result;
        }

        /**
         * Collect all questions from the knowledge structure
         * @param {Object} node - Current node in knowledge structure
         * @param {Object[]} [result=[]] - Accumulated result
         * @return {Object[]} Array of all questions
         */
        function collectAllQuestions(node, result = []) {
            // Add questions from this node
            if (node.quiz) {
                result.push(...node.quiz);
            }
            
            // Recursively add questions from children
            if (node.children) {
                for (const child of node.children) {
                    collectAllQuestions(child, result);
                }
            }
            
            return result;
        }

        /**
         * Generate adaptive quiz that adjusts difficulty based on user performance
         * @param {Object} knowledgeStructure - The knowledge structure
         * @param {Object} userPerformance - User performance data
         * @return {Object} Adaptive quiz
         */
        function generateAdaptiveQuiz(knowledgeStructure, userPerformance) {
            // Determine user's overall knowledge level
            let overallLevel = 'intermediate';
            
            if (userPerformance && userPerformance.overallScore) {
                if (userPerformance.overallScore < 40) overallLevel = 'basic';
                else if (userPerformance.overallScore > 75) overallLevel = 'advanced';
            }
            
            // Collect questions of appropriate difficulty
            const allQuestions = collectAllQuestions(knowledgeStructure);
            
            // Filter and categorize questions by difficulty
            const basicQuestions = allQuestions.filter(q => !q.difficulty || q.difficulty === 'basic');
            const intermediateQuestions = allQuestions.filter(q => q.difficulty === 'intermediate');
            const advancedQuestions = allQuestions.filter(q => q.difficulty === 'advanced');
            
            // Create quiz with appropriate difficulty distribution
            const adaptiveQuiz = {
                title: `${capitalizeFirstLetter(overallLevel)} Knowledge Assessment`,
                description: "This quiz adapts to your current knowledge level.",
                questions: []
            };
            
            // Set question distribution based on user level
            let basicCount, intermediateCount, advancedCount;
            
            switch (overallLevel) {
                case 'basic':
                    basicCount = 6;
                    intermediateCount = 3;
                    advancedCount = 1;
                    break;
                case 'intermediate':
                    basicCount = 3;
                    intermediateCount = 5;
                    advancedCount = 2;
                    break;
                case 'advanced':
                    basicCount = 1;
                    intermediateCount = 4;
                    advancedCount = 5;
                    break;
            }
            
            // Add questions according to distribution
            adaptiveQuiz.questions = [
                ...shuffleArray(basicQuestions).slice(0, basicCount),
                ...shuffleArray(intermediateQuestions).slice(0, intermediateCount),
                ...shuffleArray(advancedQuestions).slice(0, advancedCount)
            ];
            
            // Shuffle final question set
            adaptiveQuiz.questions = shuffleArray(adaptiveQuiz.questions);
            
            // Add metadata
            adaptiveQuiz.metadata = {
                difficulty: overallLevel,
                adaptiveLearning: true,
                questionDistribution: {
                    basic: basicCount,
                    intermediate: intermediateCount,
                    advanced: advancedCount
                }
            };
            
            return adaptiveQuiz;
        }

        /**
         * Helper function to capitalize the first letter of a string
         * @param {string} string - Input string
         * @return {string} String with first letter capitalized
         */
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }



    </script>
</body>
</html>
